<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/moshiax/priceinautomata/main/logo.png">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NieR:Automata</title>
    <style>
        body {
            background-color: #d1cdb7;
            font-family: "Courier New", monospace;
            color: #ffffff;
            text-shadow: 1px 1px 2px #000;
            font-size: 1.5rem;
            background-size: cover;
            background-repeat: no-repeat;
        }
html, body {
    height: 100%;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
}
@keyframes glow {
    0% {
        text-shadow: 0 0 3px rgba(255, 255, 255, 0.3); 
    }
    50% {
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.7); 
    }
    100% {
        text-shadow: 0 0 3px rgba(255, 255, 255, 0.3); 
    }
}

.fade-out {
    animation: fadeOutBackground 0.5s forwards;
}

.fade-in {
    animation: fadeInBackground 0.5s forwards;
}

@keyframes fadeOutBackground {
    from { opacity: 1; }
    to { opacity: 0; }
}

@keyframes fadeInBackground {
    from { opacity: 0; }
    to { opacity: 1; }
}


.animated-text {
    color: #FFFF00;
    animation: glow 1.5s infinite;
}

.container {
    width: 80vw; 
    height: 18vh;
    max-width: 1200px;
    max-height: 600px; 
    padding: 45px;
    background-color: rgba(0, 0, 0, 0.6);
    border-radius: 15px;
    box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.5);
    box-sizing: border-box; 
	text-align: center; 
    margin-top: -20px;
}

select, input {
    width: 100%;
    padding: 15px;
    margin-bottom: 30px;
    border-radius: 5px;
    border: none;
    background-color: #2c2c2c;
    color: #ffffff;
    font-size: 1.5rem;
    opacity: 0.65;
}

        h2 {
            margin: 0 auto;
            width: fit-content; 
            text-align: center;
        }

        .flag {
            width: 45px;
            height: 30px;
            position: fixed;
            top: 20px;
            right: 20px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .flag:hover {
            transform: scale(1.1);
        }
#result {
    font-size: 2.25rem;
    text-align: center;
    margin-top: 30px;
    color: #ffffff; 
    cursor: pointer; 
    background: linear-gradient(45deg, #ffffff, #ffffff); 
    -webkit-background-clip: text; 
    -webkit-text-fill-color: transparent; 
    text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5); 
    font-weight: bold; 
    transition: color 0.3s, transform 0.3s; 
}

#result:hover {
    color: #ffffff; 
    transform: scale(1.05); 
}

label {
    margin-bottom: 25px; 
    margin-top: -15px; 
    font-size: 1.8rem;
    display: block;
    color: #cccccc;
}


.erase {
    display: inline-block;
    white-space: nowrap;
    overflow: hidden;
    border-right: 2px solid #fff;
    animation: erase 1s steps(40, end) forwards;
}

.purchase-button {
    opacity: 0;
    animation: fadeIn 0.5s forwards;
}
body {
    transition: background-image 1s ease-in-out;
}

.fade-in {
    opacity: 1;
}

.fade-out {
    opacity: 0;
}

.purchase-button.hide {
    animation: fadeOut 0.5s forwards;
}
        input[type="number"] {
            -moz-appearance: textfield;
            -webkit-appearance: none;
            appearance: none;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%; 
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
        }
        .modal-content {
            background-color: rgba(44, 44, 44, 0.95);
            margin:  auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 15px;
            font-family: "Courier New", monospace;
            color: #ffffff;
        }
        .country-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .country-list li {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #555;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .country-list li:hover {
            background-color: #2c2c2c;
        }
        .country-list img {
            margin-right: 10px;
            width: 32px;
            height: 24px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: #ffffff;
            text-decoration: none;
            cursor: pointer;
        }
        .currency-symbol {
            position: absolute;
            right: 15px;
            bottom: 43px;
            pointer-events: none;
            color: rgba(255, 255, 255, 0.5);
            font-size: 1.5rem;
        }
        .input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        label {
            display: block;
            margin-bottom: 10px;
        }

        .currency-symbol {
            margin-left: 5px;
        }
.notification {
    display: none;
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 20px;
    background-color: rgba(0, 0, 0, 0.8);
    color: #ffffff;
    border-radius: 10px;
    box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.5);
    font-size: 1.5rem;
    text-align: center;
    animation: fadeIn 0.5s ease-in-out, fadeOut 0.5s ease-in-out 1s;
}

@keyframes fadeOutOverlay {
    from {
        opacity: 1;
    }
    to {
        opacity: 0;
    }
}

#loadingOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #000;
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-family: 'Courier New', monospace; 
    font-size: 2em;
    text-align: center;
    transition: opacity 0.5s ease;
    overflow: hidden;
}


#loadingOverlay::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('https://www.transparenttextures.com/patterns/stardust.png');
    background-size: cover;
    opacity: 0.5;
    z-index: -1; 
}

#loadingOverlay.hide {
    animation: fadeOutOverlay 0.5s ease forwards;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

@keyframes fadeOut {
    from {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
    to {
        opacity: 0;
        transform: translateX(-50%) translateY(20px);
    }
}

.purchase-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 60px; 
    height: 60px; 
    border-radius: 50%;
    background-color: transparent;

    cursor: pointer;
    margin: 0 auto;
}


.purchase-button img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
    position: absolute; 
    top: 0;
    left: 0;
    pointer-events: none; 
}

.purchase-button:hover img {
    transform: scale(1.1);
}

.purchase-button:hover {
    transform: scale(1.3);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

#waveform {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 150px; 



    display: flex;
    align-items: center;
    justify-content: center;
}
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    transition: opacity 1s ease-in-out;
    z-index: -1; /* Ensure it is behind other content */
}

.fade-out::before {
    opacity: 0;
}

.fade-in::before {
    opacity: 1;
}

.waveform-bar {
    background: linear-gradient(to top, #00f, #0ff); 
    border-radius: 2px; 
    height: 100%;
    width: 2px; /
    margin: 0 1px; 
    transform: scaleY(1); 
    transition: transform 0.1s; 
}

.waveform-bar.active {
    transform: scaleY(2); 
}

@keyframes blink-caret {
    from, to { border-color: transparent; }
    50% { border-color: orange; }
}
.purchase-button {
    opacity: 0;
    transition: opacity 0.3s ease-in-out; 
}

.purchase-button.show {
    opacity: 1;
}

.purchase-button.hide {
    opacity: 0;
}

    </style>
</head>
<body>
<div id="loadingOverlay"></div>

<div class="container">
    <label for="amount">Your money amount</label>
    <div class="input-container">
        <input type="text" id="amount" placeholder="Amount">
        <span class="currency-symbol" id="currencySymbol"></span>
    </div>
<div id="result"></div>
<div id="purchaseButtons" style="display: flex; gap: 10px; margin-top: 20px;"></div>

</div>
<canvas id="waveform" width="100%" height="100"></canvas>

<div id="notification" class="notification">
    <p>NieR:Automata is not available in your country in Steam. Switched to the USA.</p>
</div>

<div id="countryModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Select your country</h2>
		<ul class="country-list">
		<li data-country-code="US"><img src="https://flagcdn.com/48x36/us.png" alt="USA Flag"> United States</li>
		<li data-country-code="UA"><img src="https://flagcdn.com/48x36/ua.png" alt="Ukraine Flag"> Ukraine</li>
		<li data-country-code="RU"><img src="https://flagcdn.com/48x36/ru.png" alt="Russia Flag"> Russia</li>
		<li data-country-code="PL"><img src="https://flagcdn.com/48x36/pl.png" alt="Poland Flag"> Poland</li>
		<li data-country-code="KZ"><img src="https://flagcdn.com/48x36/kz.png" alt="Kazakhstan Flag"> Kazakhstan</li>
		<li data-country-code="KR"><img src="https://flagcdn.com/48x36/kr.png" alt="South Korea Flag"> South Korea</li>
		<li data-country-code="BR"><img src="https://flagcdn.com/48x36/br.png" alt="Brazil Flag"> Brazil</li>
		<li data-country-code="MX"><img src="https://flagcdn.com/48x36/mx.png" alt="Mexico Flag"> Mexico</li>
		<li data-country-code="IN"><img src="https://flagcdn.com/48x36/in.png" alt="India Flag"> India</li>
		<li data-country-code="UY"><img src="https://flagcdn.com/48x36/uy.png" alt="Uruguay Flag"> Uruguay</li>
		<li data-country-code="KW"><img src="https://flagcdn.com/48x36/kw.png" alt="Kuwait Flag"> Kuwait</li>
		<li data-country-code="ZA"><img src="https://flagcdn.com/48x36/za.png" alt="South Africa Flag"> South Africa</li>
		<li data-country-code="CR"><img src="https://flagcdn.com/48x36/cr.png" alt="Costa Rica Flag"> Costa Rica</li>
		<li data-country-code="CO"><img src="https://flagcdn.com/48x36/co.png" alt="Colombia Flag"> Colombia</li>
		<li data-country-code="NO"><img src="https://flagcdn.com/48x36/no.png" alt="Norway Flag"> Norway</li>
		<li data-country-code="CL"><img src="https://flagcdn.com/48x36/cl.png" alt="Chile Flag"> Chile</li>
		<li data-country-code="VN"><img src="https://flagcdn.com/48x36/vn.png" alt="Vietnam Flag"> Vietnam</li>
		<li data-country-code="TH"><img src="https://flagcdn.com/48x36/th.png" alt="Thailand Flag"> Thailand</li>
		<li data-country-code="IL"><img src="https://flagcdn.com/48x36/il.png" alt="Israel Flag"> Israel</li>
		<li data-country-code="SG"><img src="https://flagcdn.com/48x36/sg.png" alt="Singapore Flag"> Singapore</li>
		<li data-country-code="PE"><img src="https://flagcdn.com/48x36/pe.png" alt="Peru Flag"> Peru</li>
		<li data-country-code="EU"><img src="https://flagcdn.com/48x36/eu.png" alt="Euro Flag"> Eurozone</li>
		<li data-country-code="CH"><img src="https://flagcdn.com/48x36/ch.png" alt="Switzerland Flag"> Switzerland</li>
		<li data-country-code="JP"><img src="https://flagcdn.com/48x36/jp.png" alt="Japan Flag"> Japan</li>
		<li data-country-code="MY"><img src="https://flagcdn.com/48x36/my.png" alt="Malaysia Flag"> Malaysia</li>
		<li data-country-code="PH"><img src="https://flagcdn.com/48x36/ph.png" alt="Philippines Flag"> Philippines</li>
		<li data-country-code="HK"><img src="https://flagcdn.com/48x36/hk.png" alt="Hong Kong Flag"> Hong Kong</li>
		<li data-country-code="GB"><img src="https://flagcdn.com/48x36/gb.png" alt="United Kingdom Flag"> United Kingdom</li>
		<li data-country-code="CA"><img src="https://flagcdn.com/48x36/ca.png" alt="Canada Flag"> Canada</li>
		</ul>
    </div>
</div>

<img id="countryFlag" src="" alt="" style="cursor: pointer; position: absolute; top: 20px; right: 20px;" />


    <script>
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t.ColorThief=r()}(this,function(){if(!t)var t={map:function(t,r){var n={};return r?t.map(function(t,o){return n.index=o,r.call(n,t)}):t.slice()},naturalOrder:function(t,r){return t<r?-1:t>r?1:0},sum:function(t,r){var n={};return t.reduce(r?function(t,o,e){return n.index=e,t+r.call(n,o)}:function(t,r){return t+r},0)},max:function(r,n){return Math.max.apply(null,n?t.map(r,n):r)}};var r=function(){var r=5,n=8-r,o=1e3;function e(t,n,o){return(t<<2*r)+(n<<r)+o}function i(t){var r=[],n=!1;function o(){r.sort(t),n=!0}return{push:function(t){r.push(t),n=!1},peek:function(t){return n||o(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return n||o(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return n||o(),r}}}function u(t,r,n,o,e,i,u){this.r1=t,this.r2=r,this.g1=n,this.g2=o,this.b1=e,this.b2=i,this.histo=u}function a(){this.vboxes=new i(function(r,n){return t.naturalOrder(r.vbox.count()*r.vbox.volume(),n.vbox.count()*n.vbox.volume())})}function s(r,n){if(n.count()){var o=n.r2-n.r1+1,i=n.g2-n.g1+1,u=t.max([o,i,n.b2-n.b1+1]);if(1==n.count())return[n.copy()];var a,s,h,c,f=0,v=[],l=[];if(u==o)for(a=n.r1;a<=n.r2;a++){for(c=0,s=n.g1;s<=n.g2;s++)for(h=n.b1;h<=n.b2;h++)c+=r[e(a,s,h)]||0;v[a]=f+=c}else if(u==i)for(a=n.g1;a<=n.g2;a++){for(c=0,s=n.r1;s<=n.r2;s++)for(h=n.b1;h<=n.b2;h++)c+=r[e(s,a,h)]||0;v[a]=f+=c}else for(a=n.b1;a<=n.b2;a++){for(c=0,s=n.r1;s<=n.r2;s++)for(h=n.g1;h<=n.g2;h++)c+=r[e(s,h,a)]||0;v[a]=f+=c}return v.forEach(function(t,r){l[r]=f-t}),function(t){var r,o,e,i,u,s=t+"1",h=t+"2",c=0;for(a=n[s];a<=n[h];a++)if(v[a]>f/2){for(e=n.copy(),i=n.copy(),u=(r=a-n[s])<=(o=n[h]-a)?Math.min(n[h]-1,~~(a+o/2)):Math.max(n[s],~~(a-1-r/2));!v[u];)u++;for(c=l[u];!c&&v[u-1];)c=l[--u];return e[h]=u,i[s]=e[h]+1,[e,i]}}(u==o?"r":u==i?"g":"b")}}return u.prototype={volume:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(t){var r=this.histo;if(!this._count_set||t){var n,o,i,u=0;for(n=this.r1;n<=this.r2;n++)for(o=this.g1;o<=this.g2;o++)for(i=this.b1;i<=this.b2;i++)u+=r[e(n,o,i)]||0;this._count=u,this._count_set=!0}return this._count},copy:function(){return new u(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(t){var n=this.histo;if(!this._avg||t){var o,i,u,a,s=0,h=1<<8-r,c=0,f=0,v=0;for(i=this.r1;i<=this.r2;i++)for(u=this.g1;u<=this.g2;u++)for(a=this.b1;a<=this.b2;a++)s+=o=n[e(i,u,a)]||0,c+=o*(i+.5)*h,f+=o*(u+.5)*h,v+=o*(a+.5)*h;this._avg=s?[~~(c/s),~~(f/s),~~(v/s)]:[~~(h*(this.r1+this.r2+1)/2),~~(h*(this.g1+this.g2+1)/2),~~(h*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(t){var r=t[0]>>n;return gval=t[1]>>n,bval=t[2]>>n,r>=this.r1&&r<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},a.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var r=this.vboxes,n=0;n<r.size();n++)if(r.peek(n).vbox.contains(t))return r.peek(n).color;return this.nearest(t)},nearest:function(t){for(var r,n,o,e=this.vboxes,i=0;i<e.size();i++)((n=Math.sqrt(Math.pow(t[0]-e.peek(i).color[0],2)+Math.pow(t[1]-e.peek(i).color[1],2)+Math.pow(t[2]-e.peek(i).color[2],2)))<r||void 0===r)&&(r=n,o=e.peek(i).color);return o},forcebw:function(){var r=this.vboxes;r.sort(function(r,n){return t.naturalOrder(t.sum(r.color),t.sum(n.color))});var n=r[0].color;n[0]<5&&n[1]<5&&n[2]<5&&(r[0].color=[0,0,0]);var o=r.length-1,e=r[o].color;e[0]>251&&e[1]>251&&e[2]>251&&(r[o].color=[255,255,255])}},{quantize:function(h,c){if(!h.length||c<2||c>256)return!1;var f=function(t){var o,i=new Array(1<<3*r);return t.forEach(function(t){o=e(t[0]>>n,t[1]>>n,t[2]>>n),i[o]=(i[o]||0)+1}),i}(h);f.forEach(function(){});var v=function(t,r){var o,e,i,a=1e6,s=0,h=1e6,c=0,f=1e6,v=0;return t.forEach(function(t){(o=t[0]>>n)<a?a=o:o>s&&(s=o),(e=t[1]>>n)<h?h=e:e>c&&(c=e),(i=t[2]>>n)<f?f=i:i>v&&(v=i)}),new u(a,s,h,c,f,v,r)}(h,f),l=new i(function(r,n){return t.naturalOrder(r.count(),n.count())});function g(t,r){for(var n,e=t.size(),i=0;i<o;){if(e>=r)return;if(i++>o)return;if((n=t.pop()).count()){var u=s(f,n),a=u[0],h=u[1];if(!a)return;t.push(a),h&&(t.push(h),e++)}else t.push(n),i++}}l.push(v),g(l,.75*c);for(var p=new i(function(r,n){return t.naturalOrder(r.count()*r.volume(),n.count()*n.volume())});l.size();)p.push(l.pop());g(p,c);for(var d=new a;p.size();)d.push(p.pop());return d}}}().quantize,n=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)};n.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var o=function(){};return o.prototype.getColor=function(t,r){return void 0===r&&(r=10),this.getPalette(t,5,r)[0]},o.prototype.getPalette=function(t,o,e){var i=function(t){var r=t.colorCount,n=t.quality;if(void 0!==r&&Number.isInteger(r)){if(1===r)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");r=Math.max(r,2),r=Math.min(r,20)}else r=10;return void 0===n||Number.isInteger(n)?n=10:n<1&&(n=10),{colorCount:r,quality:n}}({colorCount:o,quality:e}),u=new n(t),a=function(t,r,n){for(var o=t,e=[],i=0,u=void 0,a=void 0,s=void 0,h=void 0,c=void 0;i<r;i+=n)a=o[0+(u=4*i)],s=o[u+1],h=o[u+2],(void 0===(c=o[u+3])||c>=125)&&(a>250&&s>250&&h>250||e.push([a,s,h]));return e}(u.getImageData().data,u.width*u.height,i.quality),s=r(a,i.colorCount);return s?s.palette():null},o.prototype.getColorFromUrl=function(t,r,n){var o=document.createElement("img"),e=this;o.addEventListener("load",function(){var i=e.getPalette(o,5,n);r(i[0],t)}),o.src=t},o.prototype.getImageData=function(t,r){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer",n.onload=function(){if(200==this.status){var t=new Uint8Array(this.response);o=t.length;for(var n=new Array(o),o=0;o<t.length;o++)n[o]=String.fromCharCode(t[o]);var e=n.join(""),i=window.btoa(e);r("data:image/png;base64,"+i)}},n.send()},o.prototype.getColorAsync=function(t,r,n){var o=this;this.getImageData(t,function(t){var e=document.createElement("img");e.addEventListener("load",function(){var t=o.getPalette(e,5,n);r(t[0],this)}),e.src=t})},o});
        const steamAppId = '524220';

async function getIpAndLocation() {
    return new Promise((resolve, reject) => {
        window.handleResponse = function(data) {
            if (data && data.country) {
                resolve({ country_code: data.country });
            } else {
                reject(new Error('No country data'));
            }
        };

        const script = document.createElement('script');
        script.src = 'https://ipinfo.io/json?callback=handleResponse';
        script.onerror = function() {
            reject(new Error('Error loading script'));
        };
        document.body.appendChild(script);
    }).catch(error => {

        showNotification('Region Detection blocked by Adblocker. Region set to USA.');
        return { country_code: 'US' }; 
    });
}



function getCurrencySymbol(currencyCode) {
    const symbols = {
        "USD": "$",
        "EUR": "€",
        "GBP": "£",
        "JPY": "¥",
        "RUB": "₽",
        "UAH": "₴",
        "BRL": "R$",
        "CAD": "C$",
        "AUD": "A$",
        "CHF": "Fr",
        "CNY": "¥",
        "KRW": "₩",
        "INR": "₹",
        "MXN": "Mex$",
        "PLN": "zł",
        "ZAR": "R",
        "TRY": "₺",
        "AED": "د.إ",
        "THB": "฿",
        "TWD": "NT$",
        "SAR": "ر.س",
        "QAR": "ر.ق",
        "KWD": "د.ك",
        "KZT": "₸",
        "MYR": "RM",
        "IDR": "Rp",
        "ILS": "₪",
        "COP": "$",
        "CRC": "₡",
        "PEN": "S/",
        "PHP": "₱",
        "VND": "₫",
        "CLP": "$",
        "RUB": "₽",
        "GEL": "₾",
        "HRK": "kn",
        "HUF": "Ft",
        "LKR": "Rs",
        "MDL": "L",
        "NOK": "kr",
        "RON": "lei",
        "SEK": "kr",
        "UGX": "USh",
        "MNT": "₮",
        "TZS": "TSh",
        "NAD": "$",
        "ZWL": "$",
        "BAM": "KM",
        "GHS": "₵",
        "BND": "$",
        "SBD": "$",
        "MOP": "MOP$",
        "PGK": "K"
    };
    return symbols[currencyCode] || currencyCode;
}



		async function getGamePrice(countryCode) {
			const steamAppId = '524220'; 
			const url = `https://store.steampowered.com/api/appdetails?appids=${steamAppId}&cc=${countryCode}&l=english&v=1`;
			const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;

			try {
				const response = await fetch(proxyUrl);
				if (!response.ok) {
					throw new Error('Network response was not ok');
				}
				const data = await response.json();

				const contents = JSON.parse(data.contents);
				return contents;
			} catch (error) {
				console.error('Error:', error);
				return null;
			}
		}

        document.getElementById('countryFlag').addEventListener('click', function() {
            const modal = document.getElementById('countryModal');
            modal.style.display = "block";
        });

        document.querySelector('.close').addEventListener('click', function() {
            const modal = document.getElementById('countryModal');
            modal.style.display = "none";
        });

        window.addEventListener('click', function(event) {
            const modal = document.getElementById('countryModal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        });

        document.querySelectorAll('.country-list li').forEach(item => {
            item.addEventListener('click', async function() {
                const selectedCountryCode = item.getAttribute('data-country-code');
                const flagSrc = item.querySelector('img').src;
                document.getElementById('countryFlag').src = flagSrc;
                document.getElementById('countryFlag').setAttribute('data-country-code', selectedCountryCode);
                document.getElementById('countryModal').style.display = "none";
                await updatePrice(selectedCountryCode);
            });
        });
		
		
let isPlaying = false; 
let currentTrack = '';


const phrases = {
    'end of yorha': {
        audio: 'music/Weight of the World the End of YoRHa.mp3',
        background: 'backgrounds/background01.png'
    },
    'weight world': {
        audio: 'music/Weight of the World⧸English Version.mp3',
        background: 'backgrounds/background02.png'
    },
    'bipolar nightmare': {
        audio: 'music/Bipolar Nightmare.mp3',
        background: 'backgrounds/background03.jpeg'
    },
    'nothing': {
        audio: 'music/Significance - Nothing.mp3',
        background: 'backgrounds/background04.jpeg'
    },
    'rays light': {
        audio: 'music/City Ruins Rays of Light.mp3',
        background: 'backgrounds/background05.jpg'
    },
    'peaceful sleep': {
        audio: 'music/Peaceful Sleep.mp3',
        background: 'backgrounds/background06.jpg'
    },
    'memories dust': {
        audio: 'music/Memories of Dust.mp3',
        background: 'backgrounds/background07.jpg'
    },
    'birth wish': {
        audio: 'music/Birth of a Wish.mp3',
        background: 'backgrounds/background08.jpg'
    },
    'color depression': {
        audio: 'music/The Color of Depression.mp3',
        background: 'backgrounds/background09.jpg'
    },
    'amusement park': {
        audio: 'music/Amusement Park.mp3',
        background: 'backgrounds/background10.jpg'
    },
    'beautiful song': {
        audio: 'music/Beautiful Song.mp3',
        background: 'backgrounds/background11.jpg'
    },
    'voice return guitar': {
        audio: 'music/Voice of No Return - Guitar.mp3',
        background: 'backgrounds/background12.jpg'
    },
    'grandma destruction': {
        audio: 'music/Grandma - Destruction.mp3',
        background: 'backgrounds/background13.jpg'
    },
    'dawn breeze': {
        audio: 'music/Dawn Breeze.mp3',
        background: 'backgrounds/background14.jpg'
    },
    'emil shop': {
        audio: 'music/Emils Shop.mp3',
        background: 'backgrounds/background15.jpg'
    },
    'treasured times': {
        audio: 'music/Treasured Times.mp3',
        background: 'backgrounds/background16.jpg'
    },
    'cold rain': {
        audio: 'music/Cold Rain.mp3',
        background: 'backgrounds/background17.jpg'
    },
    'shade': {
        audio: 'music/City Ruins Shade.mp3',
        background: 'backgrounds/background18.jpg'
    },
    'end unknown': {
        audio: 'music/End of the Unknown.mp3',
        background: 'backgrounds/background19.jpg'
    },
    'voice return normal': {
        audio: 'music/Voice of No Return - Normal.mp3',
        background: 'backgrounds/background20.jpg'
    },
    'pascal': {
        audio: 'music/Pascal.mp3',
        background: 'backgrounds/background21.jpg'
    },
    'forest kingdom': {
        audio: 'music/Forest Kingdom.mp3',
        background: 'backgrounds/background22.jpg'
    },
    'significance': {
        audio: 'music/Significance.mp3',
        background: 'backgrounds/background23.jpg'
    },
    'dark colossus': {
        audio: 'music/Dark Colossus.mp3',
        background: 'backgrounds/background24.jpg'
    },
    'copied city': {
        audio: 'music/Copied City.mp3',
        background: 'backgrounds/background25.jpg'
    },
    'wretched weaponry dynamic': {
        audio: 'music/Wretched Weaponry Dynamic.mp3',
        background: 'backgrounds/background26.jpg'
    },
    'possessed disease': {
        audio: 'music/Possessed By Disease.mp3',
        background: 'backgrounds/background27.jpg'
    },
    'broken heart': {
        audio: 'music/Broken Heart.mp3',
        background: 'backgrounds/background28.jpg'
    },
    'wretched weaponry quiet': {
        audio: 'music/Wretched Weaponry (Quiet).mp3',
        background: 'backgrounds/background29.jpg'
    },
    'mourning': {
        audio: 'music/Mourning.mp3',
        background: 'backgrounds/background30.jpg'
    },
    'dependent weakling': {
        audio: 'music/Dependent Weakling.mp3',
        background: 'backgrounds/background31.jpg'
    },
    'weight world jap': {
        audio: 'music/Weight of the World Japanese.mp3',
        background: 'backgrounds/background32.jpg'
    },
    'rebirth hope': {
        audio: 'music/Rebirth Hope.mp3',
        background: 'backgrounds/background33.jpg'
    },
    'war war': {
        audio: 'music/War War.mp3',
        background: 'backgrounds/background34.jpg'
    },
    'crumbling lies': {
        audio: 'music/Crumbling Lies.mp3',
        background: 'backgrounds/background35.jpg'
    },
    'widespread illness': {
        audio: 'music/Widespread Illness.mp3',
        background: 'backgrounds/background36.jpg'
    },
    'fortress lies': {
        audio: 'music/Fortress of Lies.mp3',
        background: 'backgrounds/background37.jpg'
    },
    'spring rain': {
        audio: 'music/Spring Rain.mp3',
        background: 'backgrounds/background38.jpg'
    },
    'atonement': {
        audio: 'music/Song Of The Ancients (Atonement).mp3',
        background: 'backgrounds/background39.jpg'
    },
    'blissful death': {
        audio: 'music/Blissful Death.mp3',
        background: 'backgrounds/background40.jpg'
    },
    'emil despair': {
        audio: 'music/Emil Despair.mp3',
        background: 'backgrounds/background41.jpg'
    },
    'starry sky': {
        audio: 'music/Starry Sky.mp3',
        background: 'backgrounds/background42.jpg'
    },
    'tower': {
        audio: 'music/The Tower.mp3',
        background: 'backgrounds/background43.jpg'
    },
    'sound end': {
        audio: 'music/The Sound of the End.mp3',
        background: 'backgrounds/background44.jpg'
    },
    'weight world fr': {
        audio: 'music/Weight of the World French.mp3',
        background: 'backgrounds/background45.jpg'
    },
};
let audioContext;
let analyser;
let bufferLength;
let dataArray;
let canvas;
let canvasCtx;

function createVisualizer() {
    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        canvas = document.createElement('canvas');
        canvas.style.position = 'fixed';
        canvas.style.bottom = '0';
        canvas.style.left = '0';
        canvas.style.width = '100%';
        canvas.style.height = '150px';
        canvas.style.pointerEvents = 'none';
        document.body.appendChild(canvas);

        canvasCtx = canvas.getContext('2d');

        analyser = audioContext.createAnalyser();
        analyser.fftSize = 256;
        bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);
    }
}

function drawVisualizer() {
    requestAnimationFrame(drawVisualizer);

    if (analyser) {
        analyser.getByteFrequencyData(dataArray);

        canvasCtx.clearRect(0, 0, canvas.width, canvas.height);

        const barWidth = (canvas.width / bufferLength) * 2.5;
        let barHeight;
        let x = 0;

        for (let i = 0; i < bufferLength; i++) {
            barHeight = dataArray[i];

            canvasCtx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            canvasCtx.fillRect(x, canvas.height - barHeight / 2, barWidth, barHeight / 2);

            x += barWidth + 1;
        }
    }
}

async function playMusic(trackName) {
    if (isPlaying && currentTrack === trackName) {
        return; 
    }

    if (isPlaying) {
        const currentAudio = document.getElementById('current-audio');
        if (currentAudio) {

            currentAudio.pause();
            currentAudio.currentTime = 0; 
            currentAudio.remove();
        }

        if (audioContext) {
            audioContext.close();
            audioContext = null;
        }
        if (canvas) {
            document.body.removeChild(canvas);
            canvas = null;
        }
    }

    const audioSrc = phrases[trackName].audio;
    const backgroundSrc = phrases[trackName].background;

    const audio = new Audio(audioSrc);
    audio.id = 'current-audio';

    audio.play().catch(error => {
        console.error('Ошибка воспроизведения:', error);
    });

    if (!audioContext) {
        createVisualizer();
    }

    const source = audioContext.createMediaElementSource(audio);
    source.connect(analyser);
    analyser.connect(audioContext.destination);

    drawVisualizer();

    audio.onended = () => {
        isPlaying = false;
        currentTrack = '';
        if (canvas) document.body.removeChild(canvas);
        if (audioContext) {
            audioContext.close();
            audioContext = null;
        }
    };

    isPlaying = true;
    currentTrack = trackName;

    changeBackground(backgroundSrc);

    document.body.appendChild(audio);
}


function loadImage(url) {
    return new Promise((resolve, reject) => {
        const img = new Image();
        img.src = url;
        img.onload = () => resolve(url);
        img.onerror = reject;
    });
}

async function updatePrice(countryCode) {
    try {
        const priceData = await getGamePrice(countryCode);
        const amountInput = document.getElementById('amount');
        const priceElement = document.getElementById('result');
        const currencySymbol = document.getElementById('currencySymbol');
        const countryFlag = document.getElementById('countryFlag');
        const purchaseButtons = document.getElementById('purchaseButtons');

        if (priceData[steamAppId] && priceData[steamAppId].data && priceData[steamAppId].data.price_overview) {
            const price = priceData[steamAppId].data.price_overview.final / 100;
            let currencyCode = priceData[steamAppId].data.price_overview.currency;
            if (countryFlag.getAttribute('data-country-code') === 'EU') {
                currencyCode = 'EUR';
            }

            currencySymbol.textContent = getCurrencySymbol(currencyCode);

            const updatePriceDisplay = () => {
                setTimeout(() => {
                    const rawAmount = amountInput.value;
                    const numericAmount = rawAmount.replace(/[^0-9]/g, '');

                    const amount = parseFloat(numericAmount);
                    if (!isNaN(amount)) {
                        const convertedAmount = Math.floor(amount / price);
                        let displayText = '';

                        if (convertedAmount > 0) {
                            if (convertedAmount.toString().includes('e')) {
                                displayText = `You can buy<br><span id="animated-text" class="animated-text">a lot but not enough</span> <br>copies of NieR:Automata.`;
                            } else {
                                displayText = `You can buy<br><span id="copyCount" class="typewriter">${convertedAmount}</span> <br>copies of NieR:Automata.`;
                            }

                            priceElement.innerHTML = displayText;
                            showPurchaseButtons();
                        } else {
                            priceElement.innerHTML = '';
                            hidePurchaseButtons();
                        }
                    } else {
                        priceElement.innerHTML = '';
                        hidePurchaseButtons();
                    }
                }, 100);
            };

            amountInput.addEventListener('input', updatePriceDisplay);

            amountInput.addEventListener('input', () => {
                const inputText = amountInput.value.trim().toLowerCase();
                for (const phraseKey in phrases) {
                    if (containsAllWords(inputText, phraseKey)) {
                        playMusic(phraseKey);
                        break;
                    }
                }
            });

            updatePriceDisplay();
        } else {
            throw new Error('Price information not available');
        }
    } catch (error) {
        console.error('Error:', error);
        showNotification('NieR:Automata is not available in your country. Switched to the USA.');
        document.getElementById('countryFlag').src = 'https://flagcdn.com/48x36/us.png';
        await updatePrice('US');
    }
}

function loadImage(url) {
    return new Promise((resolve, reject) => {
        const img = new Image();
        img.src = url;
        img.onload = () => resolve(url);
        img.onerror = reject;
    });
}

async function changeBackground(imageUrl) {
    const body = document.body;

    const style = document.createElement('style');
    style.innerHTML = `body::before { background-image: url(${imageUrl}); }`;
    document.head.appendChild(style);

    body.classList.add('fade-out');

    try {
        await loadImage(imageUrl);

        body.style.backgroundImage = `url(${imageUrl})`;
        setTimeout(() => {
            body.classList.remove('fade-out');
            body.classList.add('fade-in');
        }, 500);
    } catch (error) {
        console.error('Image loading error:', error);
    } finally {

        document.head.removeChild(style);
    }
}



function containsAllWords(inputText, phraseKey) {
    const words = phraseKey.split(' ');
    return words.every(word => inputText.includes(word));
}


function getDominantColor(imageUrl) {
    return new Promise((resolve, reject) => {
        const colorThief = new ColorThief();
        const img = new Image();
        img.crossOrigin = 'Anonymous'; 
        img.src = imageUrl;

        img.onload = () => {
            const dominantColor = colorThief.getColor(img);
            resolve(`rgb(${dominantColor[0]}, ${dominantColor[1]}, ${dominantColor[2]})`);
        };

        img.onerror = () => reject('Error loading image');
    });
}

function updatePriceDisplay() {
    const amount = parseFloat(amountInput.value);
    if (!isNaN(amount)) {
        const convertedAmount = Math.floor(amount / price);
        if (convertedAmount > 0) {
            priceElement.innerHTML = `You can buy <span class="typing-animation">${convertedAmount}</span> copies of NieR:Automata.`;
            showPurchaseButtons();
        } else {
            priceElement.innerHTML = '';
            hidePurchaseButtons(); 
        }
    } else {
        priceElement.innerHTML = '';
        hidePurchaseButtons(); 
    }
}

function showPurchaseButtons() {
    if (buttonsShown) return; 

    const buttonsContainer = document.getElementById('purchaseButtons');
    buttonsContainer.innerHTML = `
		<div class="purchase-button" id="xboxButton">
			<img src="shops/xbox.png" alt="Xbox">
		</div>
		<div class="purchase-button" id="steamButton">
			<img src="shops/steam.png" alt="Steam">
		</div>
		<div class="purchase-button" id="walmartButton">
			<img src="shops/walmart.png" alt="Walmart">
		</div>

    `;

    const buttonImages = document.querySelectorAll('.purchase-button img');
    buttonImages.forEach(async (img) => {
        try {
            const dominantColor = await getDominantColor(img.src);
            img.parentElement.style.filter = `drop-shadow(0 0 10px ${dominantColor}) brightness(1.2)`;
        } catch (error) {
            console.error('Error getting dominant color:', error);
        }
    });

    document.getElementById('xboxButton').addEventListener('click', () => {
        window.open('https://www.xbox.com/games/store/nier-automata-become-as-gods-edition/bppzvt8bz15n', '_blank');
    });

    document.getElementById('steamButton').addEventListener('click', () => {
        window.open('https://store.steampowered.com/app/524220/NieRAutomata/', '_blank');
    });

    document.getElementById('walmartButton').addEventListener('click', () => {
        window.open('https://weblet.square-enix.com/elink.php?doc=NIERAUTO&code=WEBSITE&lang=us&id=STORE19&store=Walmart&platform=PS4&edition=Game+of+the+Yorha+Edition&_gl=1*jxvhee*_gcl_au*MTQ3MzMzODA2Ny4xNzI0OTEwMTg2&_ga=2.174762210.1729472430.1724910187-1926933269.1724910187', '_blank');
    });

    const buttons = buttonsContainer.querySelectorAll('.purchase-button');
    buttons.forEach(button => {
        button.classList.remove('hide');
        button.classList.add('show');
    });

    buttonsShown = true; 
}

function hidePurchaseButtons() {
    const buttonsContainer = document.getElementById('purchaseButtons');
    const buttons = buttonsContainer.querySelectorAll('.purchase-button');
    
    buttons.forEach(button => {
        button.classList.remove('show');
        button.classList.add('hide');
    });

    setTimeout(() => {
        buttonsContainer.innerHTML = '';
        buttonsShown = false; 
    }, 300);
}



function showNotification(message) {
    const notification = document.getElementById('notification');
    notification.querySelector('p').textContent = message;
    notification.style.display = 'block';
    notification.style.animation = 'fadeIn 0.5s ease-in-out';

    setTimeout(() => {
        notification.style.animation = 'fadeOut 0.5s ease-in-out';
        setTimeout(() => {
            notification.style.display = 'none';
            notification.style.animation = ''; 
        }, 500); 
    }, 1500);
}


function setRandomBackground() {
    const backgrounds = [
        'backgrounds/background.png',
        'backgrounds/background1.png'
    ];
    const randomIndex = Math.floor(Math.random() * backgrounds.length);
    document.body.style.backgroundImage = `url(${backgrounds[randomIndex]})`;
}

window.addEventListener('load', async function() {

    const overlay = document.getElementById('loadingOverlay');
    overlay.style.display = 'flex';

    setRandomBackground();
    const locationData = await getIpAndLocation();
    const countryCode = locationData.country_code;
    document.getElementById('countryFlag').src = `https://flagcdn.com/48x36/${countryCode.toLowerCase()}.png`;
    await updatePrice(countryCode);

    overlay.classList.add('hide');

    setTimeout(() => {
        overlay.style.display = 'none';
    }, 700); 
});

document.getElementById('result').addEventListener('click', function() {
    window.open('https://store.steampowered.com/app/524220/NieRAutomata/', '_blank');
});


    </script>


</body>
</html>
