<!DOCTYPE html>
<html lang="en">
<head>

	<title>NieR:Automata Calculator </title>
	<meta name="title" content="NieR:Automata Calculator " />
	<meta name="description" content="Convert your money into NieR:Automata copies" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://moshiax.github.io/priceinautomata/" />
	<meta property="og:title" content="NieR:Automata Calculator " />
	<meta property="og:description" content="Convert your money into NieR:Automata copies" />
	<meta property="og:image" content="https://raw.githubusercontent.com/moshiax/priceinautomata/refs/heads/main/icons/meta.png" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
	<meta name="google-site-verification" content="o9KnKTL1pgRSckXmShW5N8Out0HkFHkA8vl8rA8tgIA" />
	<meta property="twitter:card" content="summary_large_image" />
	<meta property="twitter:url" content="https://moshiax.github.io/priceinautomata/" />
	<meta property="twitter:title" content="NieR:Automata Calculator " />
	<meta property="twitter:description" content="Convert your money into NieR:Automata copies" />
	<meta property="twitter:image" content="https://raw.githubusercontent.com/moshiax/priceinautomata/refs/heads/main/icons/meta.png" />

    <link rel="icon" type="image/png" href="icons/logo.png">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
html {
  height: 100%;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  -webkit-tap-highlight-color: transparent;
}

body {
  background-color: #d1cdb7;
  font-family: "Courier New", monospace;
  color: #fff;
  text-shadow: 1px 1px 2px #000;
  font-size: 1.5rem;
  background-size: cover;
  background-repeat: no-repeat;
  transition: background-image 1s ease-in-out;
  overflow: hidden;
  background-position: top;
  user-select: none; 
}

@media (max-width: 768px) {
  body {
    background-position: center;
  }
}

body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    opacity: 0;
    transition: opacity 1s ease-in-out;
}

body.fade-in::before {
    opacity: 1;
}

::selection {
  background-color: rgba(163, 163, 163, 0.25);
  color: #FFFFFF;
}

::-moz-selection {
  background-color: rgba(163, 163, 163, 0.25);
  color: #FFFFFF; 
}

::-webkit-scrollbar {
    display: none;
}

/*====================================================================*/

* {
    scrollbar-width: none; 
    cursor: var(--cursor-select);
}

input, textarea, select {
    cursor: var(--cursor-input);
}

::selection {
    cursor: var(--cursor-input);
}

:root {
    --cursor-button: url('cursors/button.png'), pointer;
    --cursor-select: url('cursors/select.png'), pointer;
    --cursor-input: url('cursors/input.png'), text;
	--cursor-link: url('cursors/link.png'), pointer;
}

/*====================================================================*/

h2 {
  margin: 0 auto;
  width: fit-content;
  text-align: center
}

.animated-text {
  color: #ff0;
  animation: glow 1.5s infinite
}


/*====================================================================*/

.container {
    width: 62.5vw;
    height: 16.67vh;
    max-width: 62.5vw;
    max-height: 55.56vh;
    padding: 4.17vh;
    background-color: rgba(0, 0, 0, .6);
    border-radius: 1.39vh;
    box-shadow: 0 0 15px rgba(0, 0, 0, .5);
    box-sizing: border-box;
    text-align: center;
    margin-top: -5.85vh;
}

@media (max-width: 768px) {
  .container {
    width: auto;
    height: 13.3vh;
	max-width: 90vw;
    overflow: visible;
  }
}

input {
  width: 100%;
  padding: 15px;
  margin-bottom: 30px;
  border-radius: 5px;
  border: none;
  background-color: #2c2c2c;
  color: #fff;
  font-size: 1.5rem;
  opacity: .55;
}

@media (max-width: 768px) {
  input
     {
    padding: 9px;
    margin-bottom: 33px;
    border-radius: 5px;
  }
}

.input-container {
  position: relative;
  display: flex;
  align-items: center
}

label {
  margin-top: -20px;
  font-size: 1.3em;
  display: block;
  color: #ccc;
  margin-bottom: 10px;
}

@media (max-width: 768px) {
  label {
    font-size: 1em; 
  }
}

.currency-symbol {
  position: absolute;
  right: 2.3vh;
  bottom: 43px;
  pointer-events: none;
  color: rgba(255,255,255,.5);
  font-size: 1.5rem
}

/*====================================================================*/

.flag {
  width: 45px;
  height: 30px;
  position: fixed;
  top: 20px;
  right: 20px;
  transition: transform .2s
}

.flag:hover {
  transform: scale(1.1)
}

/*====================================================================*/

#result {
  font-size: 2.25rem;
  text-align: center;
  margin-top: 30px;
  color: #fff;
  background: linear-gradient(45deg, #fff, #fff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 2px 2px 5px rgba(0, 0, 0, .5);
  font-weight: 700;
  transition: color .3s, transform .3s;
  user-select: none; 
}

#result:hover {
  color: #fff;
  transform: scale(1.05);
}

#purchaseButtons {
    margin-top: 0.5em;
}

/*====================================================================*/

.erase {
  display: inline-block;
  white-space: nowrap;
  overflow: hidden;
  border-right: 2px solid #fff;
  animation: erase 1s steps(40,end) forwards
}

/*====================================================================*/

.modal {
  display: none;
  position: fixed;
  z-index: 10001;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,.8)
}

.modal-content {
  background-color: rgba(44,44,44,.95);
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  width: 80%;
  max-width: 600px;
  border-radius: 15px;
  font-family: "Courier New",monospace;
  color: #fff;
  margin-top: 3vh;
}

/*====================================================================*/

.country-list {
  list-style: none;
  padding: 0;
  margin: 0
}

.country-items li {
  position: relative;
  padding: 5px;
  transition: transform 0.3s ease, background-color 0.3s ease;
  overflow: hidden; 
}

.country-items li:hover {
  transform: scale(1.2);
  background-color: rgba(163, 163, 163, 0.45)
}

.country-items img {
  width: 32px;
  height: 24px;
  user-select: none;
  pointer-events: none;
  transition: transform 0.3s ease;
}

.country-items {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(1vw, 15.5%));
  gap: 2%; 
  align-items: stretch;
  justify-items: center;
  justify-content: space-evenly;
  margin-top: 2vh; 
}

#countryFlag {
    display: block;
}

/*====================================================================*/

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: 700
  cursor: var(--cursor-link);
}

.close:focus,
.close:hover {
  color: #fff;
  text-decoration: none;
}

.notification {
  display: none;
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  padding: 20px;
  background-color: rgba(0,0,0,.8);
  color: #fff;
  border-radius: 10px;
  box-shadow: 0 0 15px rgba(0,0,0,.5);
  font-size: 1.5rem;
  text-align: center;
  z-index: 10000000;
  animation: fadeIn .5s ease-in-out,fadeOut .5s ease-in-out 1s
}

/*====================================================================*/

#loadingOverlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #101010;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    background-image: radial-gradient(#141414 1px, transparent 5px);
    background-size: 35px 35px;
    animation: moveDots 120s linear infinite;
    z-index: 9999999;
}

@keyframes moveDots {
    0% {
        background-position: 0 0;
    }
    100% {
        background-position: 100% 100%;
    }
}

#loadingOverlay.hide {
  animation: fadeOutBackground 1s ease forwards
}

/*====================================================================*/

.notification-key {
  font-weight: 700;
  color: #fff;
  background-color: #4a4a4a;
  border-radius: 4px;
  padding: 2px 6px;
  margin: 0 2px;
  box-shadow: 0 0 5px rgba(255,255,255,.6);
  transition: background-color .3s ease,box-shadow .3s ease;
  font-family: 'Courier New',monospace;
  user-select: none;
  cursor: var(--cursor-button);
}

.notification-key:hover {
  background-color: #6a6a6a;
  box-shadow: 0 0 10px #fff
}

/*====================================================================*/

#waveform {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 150px;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2999;
}

.waveform-bar {
  background: linear-gradient(to top,#00f,#0ff);
  border-radius: 2px;
  height: 100%;
  width: 2px;
  transform: scaleY(1);
  transition: transform .1s
}

.waveform-bar.active {
  transform: scaleY(2)
}

/*====================================================================*/

#play-button {
  position: fixed;
  top: 10px;
  left: 10px;
  cursor: var(--cursor-button);
  z-index: 9999
}

#play-icon {
  width: 40px;
  opacity: .35;
  cursor: var(--cursor-button);
}

#playing-icon {
  width: 40px;
  opacity: .20;
  animation: rotate 2s linear infinite;
  cursor: var(--cursor-button);
}

.volumeBar-in {
    animation: volumeBarIn 0.5s forwards;
}

.volumeBar-out {
    animation: volumeBarOut 0.5s forwards;
}

@keyframes volumeBarIn {
    from { opacity: 0; }
    to { opacity: 0.5; }
}

@keyframes volumeBarOut {
    from { opacity: 0.5; }
    to { opacity: 0; }
}

#volume-bar {
    position: fixed;
    bottom: 5vh;
    right: 1vh;
    width: 0.52vw;
    background: linear-gradient(to top, #fff, #d5d5d5);
    max-height: calc(100vh - 12%);
    background-color: #4caf50;
    opacity: 0.5;
    border-radius: 5px;
    transition: height 0.3s ease, opacity 0.5s ease, border-radius 0.3s ease;
}

@keyframes rotate {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}

.audio-toggle-btn {
	display: block; 
	margin-top: 17px;
	padding: 10px 20px;
	font-size: 16px;
	border-radius: 5px;
	border: 1px solid #ffffffaa;
	background-color: rgba(0, 0, 0, .45); 
	color: #ffffffaa;
    cursor: var(--cursor-button);
	transition: background-color 0.3s;
	overflow: hidden;
	position: relative;
   font-family: 'Courier New',monospace;
	width: 100%; 
}

.audio-toggle-btn:hover {
	background-color: rgba(0, 0, 0, .6);
}


#audioToggleBtn {
	transition: opacity 0.5s ease;
}

#audioToggleBtn.fade-out {
	opacity: 0;
}

@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

#Settings {
  position: absolute;
  top: 10px;
  cursor: var(--cursor-button);
  right: 10px;
  width: 40px;
  height: 40px; 
  opacity: 0.35;
  z-index: 9999;
}

#Settings:hover {
  animation: spin 6s linear infinite;
}


/*====================================================================*/

.pulsating {
  animation: pulsate 1s infinite
}

.hidden {
  display: none
}

/*====================================================================*/

.purchase-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 6.5vh;
  height: 6.5vh;
  border-radius: 50%;
  background-color: transparent;
  margin: 0 auto;
  z-index: 3000;
  opacity: 0;
  cursor: var(--cursor-link);
  transition: opacity 0.3s ease-in-out, transform 0.3s ease, box-shadow 0.3s ease;
  animation: fadeInModal 0.5s forwards;
}

.purchase-button.show {
  opacity: 1;
}

.purchase-button.hide {
  animation: fadeOut 0.5s forwards;
}

.purchase-button:hover {
  transform: scale(1.3);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.purchase-button img {
  width: 100%;
  height: 100%;
  transition: transform 0.3s ease;
  position: absolute;
  top: 0;
  left: 0;
  pointer-events: none;
  z-index: 3000;
}

.purchase-button:hover img {
  transform: scale(1.1);
}

/*====================================================================*/

@keyframes blink-caret {
  from,
  to {
    border-color: transparent
  }
  50% {
    border-color: orange
  }
}
@keyframes pulsate {
  0% {
    opacity: .2
  }
  50% {
    opacity: .6
  }
  100% {
    opacity: .2
  }
}
@keyframes pulse {
  0% {
    transform: scale(1);
    opacity: .2
  }
  50% {
    transform: scale(1.1);
    opacity: .5
  }
  100% {
    transform: scale(1);
    opacity: .2
  }
}
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(20px)
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0)
  }
}
@keyframes fadeOut {
  from {
    opacity: 1;
    transform: translateX(-50%) translateY(0)
  }
  to {
    opacity: 0;
    transform: translateX(-50%) translateY(20px)
  }
}

@keyframes glow {
  0% {
    text-shadow: 0 0 3px rgba(255,255,255,.3)
  }
  50% {
    text-shadow: 0 0 10px rgba(255,255,255,.7)
  }
  100% {
    text-shadow: 0 0 3px rgba(255,255,255,.3)
  }
}

@keyframes fadeOutBackground {
  from {
    opacity: 1
  }
  to {
    opacity: 0
  }
}

@keyframes fadeInBackground {
  from {
    opacity: 0
  }
  to {
    opacity: 1
  }
}

#volume-bar-container {
    display: flex;
    justify-content: center;
    margin-top: 10px;
    position: relative;
}

#volume-slider {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 10px;
    background: rgba(0, 0, 0, 0.45);
    opacity: 100;
    border-radius: 5px;
    cursor: var(--cursor-select);
    border: 1px solid #ffffffaa;
    outline: none;
    font-family: 'Courier New', monospace;
    margin-bottom: 10px;
    transition: background 0.3s ease, border-color 0.3s ease;
}


#volume-slider:hover {
    background: rgba(0, 0, 0, 0.6);
}

#volume-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 10px;
    height: 25px;
    background: #fff;
    opacity: 50%;
    border-radius: 3px;
    transition: background-color 0.3s ease, opacity 0.3s ease;
    cursor: var(--cursor-link);
}

#volume-slider::-webkit-slider-thumb:hover {
    opacity: 65%;
}

#volume-bar-container span {
    font-size: 16px;
    font-family: 'Courier New', monospace;
    color: #ffffffaa;
    position: absolute;
    top: 45%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
}
#notification p {
    line-height: 1.3;
}

@media (pointer: coarse) {
	.notification-info, #volume-bar-container {
		display: none;
	}
}
  @keyframes fadeInModal {
    0% {
      opacity: 0;
      transform: scale(0.9);
    }
    100% {
      opacity: 1;
      transform: scale(1);
    }
  }

  #countryModal {
    display: none;
    opacity: 0;
    transform: scale(0.9);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  #countryModal.show {
    display: block;
    animation: fadeInModal 0.3s forwards;
  }

    </style>
</head>
<body>
<div id="loadingOverlay"></div>
<div id="play-button">
    <img id="play-icon" src="icons/play.png" alt="Play">
    <img id="playing-icon" src="icons/playing.png" alt="Playing" style="display: none;">
</div>

<img id="Settings" src="icons/gear.png" alt="Settings"/>

<div class="container">
    <label for="amount">Your money amount</label>
    <div class="input-container">
        <input type="text" id="amount" placeholder="Amount">
        <span class="currency-symbol" id="currencySymbol"></span>
    </div>
    <div id="result"></div>
    <div id="purchaseButtons" style="display: flex;"></div>
</div>

<canvas id="waveform" width="100%" height="100"></canvas>

<div id="notification" class="notification">
    <p>NieR:Automata is not available in your country in Steam. Switched to the USA.</p>
</div>

<div id="countryModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Region & Settings</h2>
        <ul class="country-list">
            <img id="countryFlag" src="" alt="" style="display: block; margin: 10px auto 0 auto;" />
            <button class="audio-toggle-btn" onclick="toggleAudioFormat()" id="audioToggleBtn"></button>
            <div id="volume-bar-container">
                <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.7" />
            </div>

			<div class="country-items">
				<li data-country-code="US"><img src="flags/us.png"> US</li>
				<li data-country-code="UA"><img src="flags/ua.png"> UA</li>
				<li data-country-code="PL"><img src="flags/pl.png"> PL</li>
				<li data-country-code="KZ"><img src="flags/kz.png"> KZ</li>
				<li data-country-code="KR"><img src="flags/kr.png"> KR</li>
				<li data-country-code="BR"><img src="flags/br.png"> BR</li>
				<li data-country-code="MX"><img src="flags/mx.png"> MX</li>
				<li data-country-code="IN"><img src="flags/in.png"> IN</li>
				<li data-country-code="UY"><img src="flags/uy.png"> UY</li>
				<li data-country-code="KW"><img src="flags/kw.png"> KW</li>
				<li data-country-code="ZA"><img src="flags/za.png"> ZA</li>
				<li data-country-code="CR"><img src="flags/cr.png"> CR</li>
				<li data-country-code="CO"><img src="flags/co.png"> CO</li>
				<li data-country-code="NO"><img src="flags/no.png"> NO</li>
				<li data-country-code="CL"><img src="flags/cl.png"> CL</li>
				<li data-country-code="VN"><img src="flags/vn.png"> VN</li>
				<li data-country-code="TH"><img src="flags/th.png"> TH</li>
				<li data-country-code="IL"><img src="flags/il.png"> IL</li>
				<li data-country-code="SG"><img src="flags/sg.png"> SG</li>
				<li data-country-code="PE"><img src="flags/pe.png"> PE</li>
				<li data-country-code="EU"><img src="flags/eu.png"> EU</li>
				<li data-country-code="CH"><img src="flags/ch.png"> SW</li>
				<li data-country-code="JP"><img src="flags/jp.png"> JP</li>
				<li data-country-code="MY"><img src="flags/my.png"> MY</li>
				<li data-country-code="PH"><img src="flags/ph.png"> PH</li>
				<li data-country-code="HK"><img src="flags/hk.png"> HK</li>
				<li data-country-code="GB"><img src="flags/gb.png"> GB</li>
				<li data-country-code="CA"><img src="flags/ca.png"> CA</li>
				<li data-country-code="TR"><img src="flags/tr.png"> TR</li>
				<li data-country-code="RU"><img src="flags/ru.png"> RU</li>
			</div>

        </ul>
        <div class="notification-info" style="text-align: right; line-height: 1.3;">
            <p>
                You can switch the UI by pressing <span class="notification-key" data-key="[H]">[H]</span>,<br>
                Pause by <span class="notification-key" data-key="[P]">[P]</span>,<br>
                Play next by <span class="notification-key" data-key="[N]">[N]</span>,<br>
                Switch the quality of audio by <span class="notification-key" data-key="[Q]">[Q]</span>,<br>
                And volume by arrow keys.
            </p>
        </div>
    </div>
</div>

    <script>
	
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t||self).ColorThief=n()}(this,function(){var t=function(t,n){return t<n?-1:t>n?1:0},n=function(t){return t.reduce(function(t,n){return t+n},0)},r=/*#__PURE__*/function(){function t(t){this.colors=t}var n=t.prototype;return n.palette=function(){return this.colors},n.map=function(t){return t},t}(),o=function(){function o(t,n,r){return(t<<10)+(n<<5)+r}function e(t){var n=[],r=!1;function o(){n.sort(t),r=!0}return{push:function(t){n.push(t),r=!1},peek:function(t){return r||o(),void 0===t&&(t=n.length-1),n[t]},pop:function(){return r||o(),n.pop()},size:function(){return n.length},map:function(t){return n.map(t)},debug:function(){return r||o(),n}}}function i(t,n,r,o,e,i,u){var a=this;a.r1=t,a.r2=n,a.g1=r,a.g2=o,a.b1=e,a.b2=i,a.histo=u}function u(){this.vboxes=new e(function(n,r){return t(n.vbox.count()*n.vbox.volume(),r.vbox.count()*r.vbox.volume())})}function a(t,n){if(n.count()){var r=n.r2-n.r1+1,e=n.g2-n.g1+1,i=Math.max.apply(null,[r,e,n.b2-n.b1+1]);if(1==n.count())return[n.copy()];var u,a,c,f,s=0,h=[],l=[];if(i==r)for(u=n.r1;u<=n.r2;u++){for(f=0,a=n.g1;a<=n.g2;a++)for(c=n.b1;c<=n.b2;c++)f+=t[o(u,a,c)]||0;h[u]=s+=f}else if(i==e)for(u=n.g1;u<=n.g2;u++){for(f=0,a=n.r1;a<=n.r2;a++)for(c=n.b1;c<=n.b2;c++)f+=t[o(a,u,c)]||0;h[u]=s+=f}else for(u=n.b1;u<=n.b2;u++){for(f=0,a=n.r1;a<=n.r2;a++)for(c=n.g1;c<=n.g2;c++)f+=t[o(a,c,u)]||0;h[u]=s+=f}return h.forEach(function(t,n){l[n]=s-t}),function(t){var r,o,e,i,a,c=t+"1",f=t+"2",v=0;for(u=n[c];u<=n[f];u++)if(h[u]>s/2){for(e=n.copy(),i=n.copy(),a=(r=u-n[c])<=(o=n[f]-u)?Math.min(n[f]-1,~~(u+o/2)):Math.max(n[c],~~(u-1-r/2));!h[a];)a++;for(v=l[a];!v&&h[a-1];)v=l[--a];return e[f]=a,i[c]=e[f]+1,[e,i]}}(i==r?"r":i==e?"g":"b")}}return i.prototype={volume:function(t){var n=this;return n._volume&&!t||(n._volume=(n.r2-n.r1+1)*(n.g2-n.g1+1)*(n.b2-n.b1+1)),n._volume},count:function(t){var n=this,r=n.histo;if(!n._count_set||t){var e,i,u,a=0;for(e=n.r1;e<=n.r2;e++)for(i=n.g1;i<=n.g2;i++)for(u=n.b1;u<=n.b2;u++)a+=r[o(e,i,u)]||0;n._count=a,n._count_set=!0}return n._count},copy:function(){var t=this;return new i(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(t){var n=this,r=n.histo;if(!n._avg||t){var e,i,u,a,c=0,f=0,s=0,h=0;if(n.r1===n.r2&&n.g1===n.g2&&n.b1===n.b2)n._avg=[n.r1<<3,n.g1<<3,n.b1<<3];else{for(i=n.r1;i<=n.r2;i++)for(u=n.g1;u<=n.g2;u++)for(a=n.b1;a<=n.b2;a++)c+=e=r[o(i,u,a)]||0,f+=e*(i+.5)*8,s+=e*(u+.5)*8,h+=e*(a+.5)*8;n._avg=c?[~~(f/c),~~(s/c),~~(h/c)]:[~~(8*(n.r1+n.r2+1)/2),~~(8*(n.g1+n.g2+1)/2),~~(8*(n.b1+n.b2+1)/2)]}}return n._avg},contains:function(t){var n=this,r=t[0]>>3;return gval=t[1]>>3,bval=t[2]>>3,r>=n.r1&&r<=n.r2&&gval>=n.g1&&gval<=n.g2&&bval>=n.b1&&bval<=n.b2}},u.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var n=this.vboxes,r=0;r<n.size();r++)if(n.peek(r).vbox.contains(t))return n.peek(r).color;return this.nearest(t)},nearest:function(t){for(var n,r,o,e=this.vboxes,i=0;i<e.size();i++)((r=Math.sqrt(Math.pow(t[0]-e.peek(i).color[0],2)+Math.pow(t[1]-e.peek(i).color[1],2)+Math.pow(t[2]-e.peek(i).color[2],2)))<n||void 0===n)&&(n=r,o=e.peek(i).color);return o},forcebw:function(){var r=this.vboxes;r.sort(function(r,o){return t(n(r.color),n(o.color))});var o=r[0].color;o[0]<5&&o[1]<5&&o[2]<5&&(r[0].color=[0,0,0]);var e=r.length-1,i=r[e].color;i[0]>251&&i[1]>251&&i[2]>251&&(r[e].color=[255,255,255])}},{quantize:function(n,c){if(!Number.isInteger(c)||c<1||c>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!n.length||c<2||c>256)return!1;if(!n.length||c<2||c>256)return!1;for(var f=[],s=new Set,h=0;h<n.length;h++){var l=n[h],v=l.join(",");s.has(v)||(s.add(v),f.push(l))}if(f.length<=c)return new r(f);var g=function(t){var n,r=new Array(32768);return t.forEach(function(t){n=o(t[0]>>3,t[1]>>3,t[2]>>3),r[n]=(r[n]||0)+1}),r}(n);g.forEach(function(){});var p=function(t,n){var r,o,e,u=1e6,a=0,c=1e6,f=0,s=1e6,h=0;return t.forEach(function(t){(r=t[0]>>3)<u?u=r:r>a&&(a=r),(o=t[1]>>3)<c?c=o:o>f&&(f=o),(e=t[2]>>3)<s?s=e:e>h&&(h=e)}),new i(u,a,c,f,s,h,n)}(n,g),b=new e(function(n,r){return t(n.count(),r.count())});function d(t,n){for(var r,o=t.size(),e=0;e<1e3;){if(o>=n)return;if(e++>1e3)return;if((r=t.pop()).count()){var i=a(g,r),u=i[0],c=i[1];if(!u)return;t.push(u),c&&(t.push(c),o++)}else t.push(r),e++}}b.push(p),d(b,.75*c);for(var m=new e(function(n,r){return t(n.count()*n.volume(),r.count()*r.volume())});b.size();)m.push(b.pop());d(m,c);for(var w=new u;m.size();)w.push(m.pop());return w}}}().quantize,e=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=t.naturalWidth,this.height=this.canvas.height=t.naturalHeight,this.context.drawImage(t,0,0,this.width,this.height)};e.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var u=function(){};return u.prototype.getColor=function(t,n){return void 0===n&&(n=10),this.getPalette(t,5,n)[0]},u.prototype.getPalette=function(t,n,r){var i=function(t){var n=t.colorCount,r=t.quality;if(void 0!==n&&Number.isInteger(n)){if(1===n)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");n=Math.max(n,2),n=Math.min(n,20)}else n=10;return(void 0===r||!Number.isInteger(r)||r<1)&&(r=10),{colorCount:n,quality:r}}({colorCount:n,quality:r}),u=new e(t),a=function(t,n,r){for(var o,e,i,u,a,c=t,f=[],s=0;s<n;s+=r)e=c[0+(o=4*s)],i=c[o+1],u=c[o+2],(void 0===(a=c[o+3])||a>=125)&&(e>250&&i>250&&u>250||f.push([e,i,u]));return f}(u.getImageData().data,u.width*u.height,i.quality),c=o(a,i.colorCount);return c?c.palette():null},u.prototype.getColorFromUrl=function(t,n,r){var o=this,e=document.createElement("img");e.addEventListener("load",function(){var i=o.getPalette(e,5,r);n(i[0],t)}),e.src=t},u.prototype.getImageData=function(t,n){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){if(200==this.status){var t=new Uint8Array(this.response);i=t.length;for(var r=new Array(i),o=0;o<t.length;o++)r[o]=String.fromCharCode(t[o]);var e=r.join(""),u=window.btoa(e);n("data:image/png;base64,"+u)}},r.send()},u.prototype.getColorAsync=function(t,n,r){var o=this;this.getImageData(t,function(t){var e=document.createElement("img");e.addEventListener("load",function(){var t=o.getPalette(e,5,r);n(t[0],this)}),e.src=t})},u});const getDominantColor = (imageUrl) => new Promise((resolve, reject) => { const img = new Image(); img.crossOrigin = 'Anonymous'; img.src = imageUrl; img.onload = () => resolve(`rgb(${new ColorThief().getColor(img).join(', ')})`); img.onerror = () => reject('Error loading image'); });

<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>
<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>
<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>

const steamAppId = '524220';

async function getIpAndLocation() {
    return fetch('https://freeipapi.com/api/json/')
        .then(response => response.json())
        .then(data => {
            if (data && data.countryCode) {
                return { country_code: data.countryCode };
            }
            return { country_code: 'US' };
        })
        .catch(error => {
            console.log("Failed to fetch location:", error);
			showNotification('Region Detection blocked by Adblocker. Region set to USA.');
            return { country_code: 'US' };
        });
}

let globalDiscountPercent = null;

async function getGamePrice(countryCode) {
    const url = `https://store.steampowered.com/api/appdetails?appids=${steamAppId}&cc=${countryCode}&l=english&v=1`;
    const proxyUrl = `https://api.cors.lol/?url=${encodeURIComponent(url)}`;
    let attempts = 0;
    const maxAttempts = 1;
    const timeoutDuration = 2222;

    while (attempts < maxAttempts) {
        try {
            const controller = new AbortController();
            const signal = controller.signal;
            const timeoutId = setTimeout(() => controller.abort(), timeoutDuration);

            const startTime = performance.now();
            console.log(`Attempt ${attempts + 1}: Fetching URL: ${proxyUrl}`);
            const response = await fetch(proxyUrl, { signal });
            const endTime = performance.now();
            const duration = (endTime - startTime).toFixed(2);

            clearTimeout(timeoutId);

            if (!response.ok) {
                throw new Error(`HTTP Error: ${response.status} - ${response.statusText}`);
            }

            const contents = await response.text();
            console.log(`Received response from proxy in ${duration}ms`);

            const data = JSON.parse(contents);

            if (data[steamAppId]?.data?.price_overview) {
                const discountPercent = data[steamAppId].data.price_overview.discount_percent;
                globalDiscountPercent = discountPercent && discountPercent !== 0 ? discountPercent : null;
                console.log(`Price fetched dynamically in ${duration}ms, discount: ${globalDiscountPercent || "no discount"}`);
            }

            return data;

        } catch (error) {
            attempts++;
            console.error(`Error during fetch attempt ${attempts}:`, error);

            if (attempts < maxAttempts) {
                await new Promise(resolve => setTimeout(resolve, 500));
            } else {
                console.error('Error fetching prices. CORS proxy possible dead :(');
                return getPriceDataFallback(countryCode);
            }
        }
    }
}


function getPriceDataFallback(countryCode) {
	const priceInfo = priceData.find(item => item.region === countryCode);
	return {
		[steamAppId]: {
			success: !!priceInfo,
			data: priceInfo ? { price_overview: { final: priceInfo.price * 100, currency: priceInfo.currency_code } } : null,
		},
	};
}

const modal = document.getElementById('countryModal');
const settingsButton = document.getElementById('Settings');
const closeButton = document.querySelector('.close');

settingsButton.addEventListener('click', () => modal.classList.add('show'));

closeButton.addEventListener('click', () => modal.classList.remove('show'));

window.addEventListener('click', (event) => {
    if (event.target === modal) {
        modal.classList.remove('show');
    }
});

<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>
<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>
<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>

let isPlaying = false; 
let currentTrack = '';
let audioContext;
let analyser;
let bufferLength;
let dataArray;
let canvas;
let canvasCtx;
let currentTrackAudioSrc = '';
let audioFormatPreference = /mobile/i.test(navigator.userAgent) ? 1 : 0;
let audioVolume = loadVolumeFromCookie();
audioVolume = audioVolume !== null ? audioVolume : 0.7;
console.log(audioVolume !== 0.7 
    ? `Volume loaded from cookie: ${audioVolume}` 
    : `Default volume set: ${audioVolume}`);

let audio = null;
let hideTimeout;

document.getElementById('volume-slider').value = audioVolume;

function saveAudioFormatPreferenceToCookie() {
    document.cookie = `audioFormatPreference=${audioFormatPreference}; path=/; expires=Sun, 31 Dec 11944 23:59:59 GMT`;
}

function loadAudioFormatPreferenceFromCookie() {
    const cookies = document.cookie.split('; ');
    const formatPreferenceCookie = cookies.find(row => row.startsWith('audioFormatPreference='));
    if (formatPreferenceCookie) {
        audioFormatPreference = parseInt(formatPreferenceCookie.split('=')[1]);
        
        let format;
        if (audioFormatPreference === 1) {
            format = 'mp3';
        } else if (audioFormatPreference === 2) {
            format = 'flac';
        } else {
            format = 'auto';
        }

        console.log(`Loaded: ${format}`);
    }
}

loadAudioFormatPreferenceFromCookie();
updateButtonText();

const phrases = {
	// "Weight of the World"
	'end of yorha': { audio: 'music/Weight of the World the End of YoRHa', background: 'backgrounds/background01.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Weight of the World the End of YoRHa', artist: 'Keiichi Okabe, Vocals & Chorus: YoRHa' },
	'weight world': { audio: 'music/Weight of the World⧸English Version', background: 'backgrounds/background02.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Weight of the World English Version', artist: 'Keiichi Okabe, Vocals: J\'Nique Nicole' },
	'jap': { audio: 'music/Weight of the World Japanese', background: 'backgrounds/background02.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Weight of the World Kowaretasekainouta', artist: 'Keiichi Okabe, Vocals: Marina Kawano' },
	'fr': { audio: 'music/Weight of the World French', background: 'backgrounds/background02.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Weight of the World Nouveau - FR Version', artist: 'Keiichi Okabe, Vocals: Emi Evans' },

	// "Voice of no Return"
	'voice return': { audio: 'music/Voice of no Return - Guitar', background: 'backgrounds/background11.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Voice of No Return - Guitar', artist: 'Keiichi Okabe, Vocals?: Emi Evans' },
	'normal': { audio: 'music/Voice of no Return - Normal', background: 'backgrounds/background11.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Voice of No Return - Normal', artist: 'Keiichi Okabe, Vocals?: Emi Evans' },

	// "Song of the Ancients"
	'atonement': { audio: 'music/Song of the Ancients - Atonement', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Song of the Ancients - Atonement', artist: 'Keiichi Okabe, Vocals?: Emi Evans' },
	'song ancients': { audio: 'music/Song of the Ancients - Atonement', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Song of the Ancients - Atonement', artist: 'Keiichi Okabe, Vocals?: Emi Evans' },

	// "Wretched Weaponry"
	'dynamic': { audio: 'music/Wretched Weaponry Dynamic', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Wretched Weaponry: Medium/Dynamic', artist: 'Keiichi Okabe, Vocals?: Emi Evans, Nami Nakagawa' },
	'quiet': { audio: 'music/Wretched Weaponry Quiet', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Wretched Weaponry: Quiet', artist: 'Keiichi Okabe, Vocals?: Emi Evans' },
	'wretched weaponry': { audio: 'music/Wretched Weaponry Dynamic', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Wretched Weaponry: Medium/Dynamic', artist: 'Keiichi Okabe, Vocals?: Emi Evans, Nami Nakagawa' },


	// Fights
	'bipolar nightmare': { audio: 'music/Bipolar Nightmare', background: 'backgrounds/background03.jpg', backgroundAndroid: 'backgrounds/android03.jpg', title: 'Bipolar Nightmare', artist: 'Keigo Hoashi, Vocals?: Nami Nakagawa, NieR:Automata Choir' },
	'significance': { audio: 'music/Significance', background: 'backgrounds/background04.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Significance', artist: 'Keiichi Okabe, Vocals?: Marina Kawano, Emi Evans' },
	'beautiful song': { audio: 'music/Beautiful Song', background: 'backgrounds/background10.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'A Beautiful Song', artist: 'Keigo Hoashi, Vocals?: Emi Evans, J\'Nique Nicole, NieR:Automata Choir' },
	'dark colossus': { audio: 'music/Dark Colossus - Kaiju', background: 'backgrounds/darkcolossus.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Dark Colossus - Kaiju', artist: 'Keigo Hoashi & Keiichi Okabe, Vocals?: Emi Evans' },
	'war war': { audio: 'music/War & War', background: 'backgrounds/background.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'War & War', artist: 'Keigo Hoashi & Keiichi Okabe, Vocals?: NieR:Automata Choir' },
	'grandma destruction': { audio: 'music/Grandma - Destruction', background: 'backgrounds/background13.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Grandma - Destruction', artist: 'Kuniyuki Takahashi & Keiichi Okabe, Vocals?: NieR:Automata Choir' },

	// Places
	'rays light': { audio: 'music/City Ruins - Rays of Light', background: 'backgrounds/background05.jpg', backgroundAndroid: 'backgrounds/android05.jpg', title: 'City Ruins - Rays of Light', artist: 'Keiichi Okabe, Vocals?: J\'Nique Nicole' },
	'shade': { audio: 'music/City Ruins - Shade', background: 'backgrounds/shade.jpg', backgroundAndroid: 'backgrounds/shade-android.jpg', title: 'City Ruins - Shade', artist: 'Keiichi Okabe, Vocals?: Emi Evans' },
	'copied city': { audio: 'music/Copied City', background: 'backgrounds/copiedcity.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Copied City', artist: 'Keigo Hoashi, Vocals?: Nami Nakagawa' },
	'memories dust': { audio: 'music/Memories of Dust', background: 'backgrounds/background07.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Memories of Dust', artist: 'Kuniyuki Takahashi, Vocals?: J\'Nique Nicole' },
	'forest kingdom': { audio: 'music/Forest Kingdom', background: 'backgrounds/background02.jpg', backgroundAndroid: 'backgrounds/android02.jpg', title: 'Forest Kingdom', artist: 'Keigo Hoashi, Vocals?: Nami Nakagawa' },
	'pascal': { audio: 'music/Pascal', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Pascal', artist: 'Keiichi Okabe, Vocals?: Saki Ishii' },
	'amusement park': { audio: 'music/Amusement Park', background: 'backgrounds/background09.jpg', backgroundAndroid: 'backgrounds/android4.jpg', title: 'Amusement Park', artist: 'Keigo Hoashi, Vocals?: Emi Evans' },
	'tower': { audio: 'music/The Tower', background: 'backgrounds/backgroundtower.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'The Tower', artist: 'Keiichi Okabe, Vocals?: Emi Evans, J\'Nique Nicole' },
	'sound end': { audio: 'music/The Sound of the End', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'The Sound of the End', artist: 'Keigo Hoashi, Vocals?: Nami Nakagawa' },
	'alien': { audio: 'music/Alien Manifestation', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Alien Manifestation', artist: 'Keigo Hoashi & Keiichi Okabe, Vocals?: Nami Nakagawa' },

	// Ambient
	'peaceful sleep': { audio: 'music/Peaceful Sleep', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Peaceful Sleep', artist: 'Keiichi Okabe, Vocals?: Emi Evans' },
	'birth wish': { audio: 'music/Birth of a Wish', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Birth of a Wish', artist: 'Keiichi Okabe, Vocals?: NieR:Automata Choir' },
	'dawn breeze': { audio: 'music/Faltering Prayer - Dawn Breeze', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Faltering Prayer - Dawn Breeze', artist: 'Keigo Hoashi & Keiichi Okabe, Vocals?: Emi Evans' },
	'cold rain': { audio: 'music/Vague Hope - Cold Rain', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Vague Hope - Cold Rain', artist: 'Keigo Hoashi, Vocals?: Emi Evans' },
	'spring rain': { audio: 'music/Vague Hope - Spring Rain', background: 'backgrounds/springrain.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Vague Hope - Spring Rain', artist: 'Keigo Hoashi, Vocals?: Emi Evans' },
	'nothing': { audio: 'music/Significance - Nothing', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Significance - Nothing', artist: 'Keiichi Okabe, Vocals?: J\'Nique Nicole' },
	'rebirth hope': { audio: 'music/Rebirth & Hope', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Rebirth & Hope', artist: 'Keigo Hoashi, Vocals?: Emi Evans, Nami Nakagawa, Marina Kawano' },
	'treasured times': { audio: 'music/Treasured Times', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Treasured Times', artist: 'Keigo Hoashi, Vocals?: Saki Ishii' },
	'end unknown': { audio: 'music/End of the Unknown', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'End of the Unknown', artist: 'Keiichi Okabe, Vocals?: NieR:Automata Choir' },
	'starry sky': { audio: 'music/Starry Sky', background: 'backgrounds/starrysky.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Starry Sky', artist: 'Keigo Hoashi & Keiichi Okabe, Vocals?: Emi Evans' },

	// Emil
	'emil shop': { audio: 'music/Emils Shop', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Emil\'s Shop', artist: 'Kuniyuki Takahashi & Kakeru Ishihama, Vocals?: Mai Kadowaki' },
	'emil despair': { audio: 'music/Emil - Despair', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Emil - Despair', artist: 'Keigo Hoashi & Kakeru Ishihama, Vocals?: Nami Nakagawa' },

	// Other
	'crumbling lies': { audio: 'music/Crumbling Lies', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Crumbling Lies', artist: 'Keigo Hoashi, Vocals?: NieR:Automata Choir' },
	'fortress lies': { audio: 'music/Fortress of Lies', background: 'backgrounds/fortressoflies.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Fortress of Lies', artist: 'Keiichi Okabe, Vocals?: Emi Evans' },
	'widespread illness': { audio: 'music/Widespread Illness', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Widespread Illness', artist: 'Keigo Hoashi' },
	'blissful death': { audio: 'music/Blissful Death', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Blissful Death', artist: 'Keiichi Okabe' },
	'mourning': { audio: 'music/Mourning', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Mourning', artist: 'Keiichi Okabe, Vocals?: NieR:Automata Choir' },
	'dependent weakling': { audio: 'music/Dependent Weakling', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Dependent Weakling', artist: 'Kuniyuki Takahashi, Vocals?: NieR:Automata Choir' },
	'possessed disease': { audio: 'music/Possessed by Disease', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Possessed by Disease', artist: 'Keiichi Okabe, Vocals?: Nami Nakagawa' },
	'broken heart': { audio: 'music/Broken Heart', background: 'backgrounds/!!!!!!!!!.jpg', backgroundAndroid: 'backgrounds/!!!!!!!!!.jpg', title: 'Broken Heart', artist: 'Keigo Hoashi, Vocals?: Emi Evans' },

};

async function fadeOutAudio(audio, duration = 1000) {
    if (!audio) return;
    let volume = audio.volume;
    const step = volume / (duration / 50);

    return new Promise(resolve => {
        const fadeOutInterval = setInterval(() => {
            if (volume > 0) {
                volume = Math.max(0, volume - step);
                audio.volume = volume;
            } else {
                clearInterval(fadeOutInterval);
                audio.pause();
                audio.currentTime = 0;
                resolve();
            }
        }, 50);
    });
}

function fadeInAudio(audio, duration = 1000) {
    let volume = 0;
    const targetVolume = audioVolume; 
    const step = targetVolume / (duration / 50);
    audio.volume = 0;
    audio.play().catch(error => console.error('Error:', error));

    const fadeInInterval = setInterval(() => {
        if (volume < targetVolume) {
            volume = Math.min(targetVolume, volume + step);
            audio.volume = volume;
        } else {
            clearInterval(fadeInInterval);
        }
    }, 50);
}

function smoothSetSliderValue(slider, targetValue) {
    const currentValue = parseFloat(slider.value);
    const step = (targetValue - currentValue) / 15; 

    let frame = 0;
    function animate() {
        if (frame < 15) {
            slider.value = (currentValue + step * frame).toFixed(2);
            frame++;
            requestAnimationFrame(animate);
        } else {
            slider.value = targetValue.toFixed(2);
        }
    }

    animate();
}

document.addEventListener('keydown', (event) => {
    if (event.key === 'ArrowUp' || event.key === 'ArrowDown') {
        audioVolume = event.key === 'ArrowUp'
            ? Math.min(audioVolume + 0.05, 1)
            : Math.max(audioVolume - 0.05, 0);

        if (audio) {
            audio.volume = audioVolume;
        }

        saveVolumeToCookie(audioVolume);
        showVolumeBar(audioVolume);
        smoothSetSliderValue(document.getElementById('volume-slider'), audioVolume);
    }
});

document.getElementById('volume-slider').addEventListener('input', (event) => {
    audioVolume = parseFloat(event.target.value);
    if (audio) {
        audio.volume = audioVolume;
    }
    saveVolumeToCookie(audioVolume);
    showVolumeBar(audioVolume);
});


function saveVolumeToCookie(volume) {
    document.cookie = `audioVolume=${volume}; path=/; expires=Sun, 31 Dec 11944 23:59:59 GMT`;
}

function loadVolumeFromCookie() {
    const cookies = document.cookie.split('; ');
    const volumeCookie = cookies.find(row => row.startsWith('audioVolume='));
    return volumeCookie ? parseFloat(volumeCookie.split('=')[1]) : null;
}

const volumeText = document.createElement('span');
volumeText.textContent = 'Volume'; 
document.getElementById('volume-bar-container').appendChild(volumeText);

function showVolumeBar(volume) {
    let volumeBar = document.getElementById('volume-bar');
    if (!volumeBar) {
        volumeBar = document.createElement('div');
        volumeBar.id = 'volume-bar';
        document.body.appendChild(volumeBar);
    }

    volumeBar.style.height = `${volume * 100}%`;
    volumeBar.classList.add('volumeBar-in');
    volumeBar.style.visibility = 'visible';
    clearTimeout(hideTimeout);

    hideTimeout = setTimeout(() => {
        volumeBar.classList.add('volumeBar-out');
        setTimeout(() => {
            volumeBar.style.visibility = 'hidden';
            volumeBar.classList.remove('volumeBar-out');
        }, 500);
    }, 1000);
}

async function playMusic(trackName, isRandomPlay = false) {
    let format;

    if (audioFormatPreference === 1) {
        format = '.mp3';
        console.log("Chosen: mp3");
    } else if (audioFormatPreference === 2) {
        format = '.flac';
        console.log("Chosen: flac");
    } else {
        format = isFlacSupported() ? '.flac' : '.mp3';
        console.log(`Auto: ${format === '.flac' ? 'flac' : 'mp3'}`);
    }

    const audioSrc = phrases[trackName].audio + format;

    if (isPlaying && currentTrackAudioSrc === audioSrc) {
        return;
    }

    if (isPlaying) {
        await fadeOutAudio(document.getElementById('current-audio'));
        stopMusic();
    }

    audio = new Audio(audioSrc);
    audio.id = 'current-audio';
    audio.volume = audioVolume; 
    const aspectRatio = window.innerWidth / window.innerHeight;

    const backgroundSrc =
        (Math.abs(aspectRatio - 9 / 16) < Math.abs(aspectRatio - 16 / 9) &&
            phrases[trackName].backgroundAndroid !== "backgrounds/!!!!!!!!!.jpg")
            ? phrases[trackName].backgroundAndroid
            : phrases[trackName].background;

    const artworkSrc = phrases[trackName].background;

    if (!audioContext) {
        createVisualizer();
    }

    const source = audioContext.createMediaElementSource(audio);
    source.connect(analyser);
    analyser.connect(audioContext.destination);

    await changeBackground(backgroundSrc);
    drawVisualizer();

    if ('mediaSession' in navigator) {
        navigator.mediaSession.metadata = new MediaMetadata({
            title: phrases[trackName].title,
            artist: phrases[trackName].artist,
        });
    }

    const img = new Image();
    img.src = artworkSrc;

    audio.onended = () => {
        isPlaying = false;
        currentTrackAudioSrc = '';
        if (canvas) document.body.removeChild(canvas);
        if (audioContext) {
            audioContext.close();
            audioContext = null;
        }
        updatePlayIcon();

        if (isRandomPlay) {
            playRandomMusic();
        } else {
            toggleVisibility();
        }
    };

    isPlaying = true;
    currentTrackAudioSrc = audioSrc;

    const container = document.querySelector('.container');
    const countryFlag = document.getElementById('countryFlag');
    const isContainerVisible = container && getComputedStyle(container).display !== 'none' && getComputedStyle(container).visibility !== 'hidden';
    const isCountryFlagVisible = countryFlag && getComputedStyle(countryFlag).display !== 'none' && getComputedStyle(countryFlag).visibility !== 'hidden';

    if (isContainerVisible && isCountryFlagVisible) {
        toggleVisibility();
    }

	function saveNotificationCountToCookie(count) {
		document.cookie = `notificationCount=${count}; path=/; expires=Sun, 31 Dec 11944 23:59:59 GMT`;
	}

    function loadNotificationCountFromCookie() {
        const cookies = document.cookie.split('; ');
        const notificationCookie = cookies.find(row => row.startsWith('notificationCount='));
        return notificationCookie ? parseInt(notificationCookie.split('=')[1]) : 0;
    }

    let notificationCount = loadNotificationCountFromCookie();
	const isMobile = window.matchMedia('(pointer: coarse)').matches;

	if (notificationCount < 3 && !isMobile) {
		showNotification(
			'You can switch the UI by pressing [H] on keyboard,\n' +
			'Pause by [P],\n' +
			'Play next by [N],\n' +
			'Switch the quality of audio by [Q], \n' +
			'And volume by arrowkeys'
		);
		notificationCount++;
		saveNotificationCountToCookie(notificationCount);
	}

    document.body.appendChild(audio);
    fadeInAudio(audio);
    updatePlayIcon();
    img.onload = () => {
        if ('mediaSession' in navigator) {
            navigator.mediaSession.metadata.artwork = [
                {
                    src: artworkSrc,
                    sizes: `${img.width}x${img.height}`,
                    type: 'image/jpeg'
                }
            ];
        }
    };

    const amountInput = document.getElementById('amount');
    if (amountInput) {
        amountInput.value = '';
    }
}

function isFlacSupported() {
    const audio = new Audio();
    return audio.canPlayType('audio/flac;') !== '';
}

function playRandomMusic() {
    const trackNames = Object.keys(phrases);
    const randomTrack = trackNames[Math.floor(Math.random() * trackNames.length)];
    playMusic(randomTrack, true); 
}

function stopMusic() {
    const currentAudio = document.getElementById('current-audio');
    if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0; 
        currentAudio.remove();
    }

    if (audioContext) {
        audioContext.close();
        audioContext = null;
    }
    if (canvas) {
        document.body.removeChild(canvas);
        canvas = null;
    }

    isPlaying = false;
    updatePlayIcon();
    currentTrackAudioSrc = '';
}

function updatePlayIcon() {
    const playIcon = document.getElementById('play-icon');
    const playingIcon = document.getElementById('playing-icon');

    if (isPlaying) {
        playIcon.style.display = 'none';
        playingIcon.style.display = 'block';
    } else {
        playIcon.style.display = 'block';
        playingIcon.style.display = 'none';
    }
}

document.getElementById('play-button').addEventListener('click', async () => {
    if (isPlaying) {
        await fadeOutAudio(document.getElementById('current-audio'));
        stopMusic();
		toggleVisibility();
    } else {
        if (currentTrack) {
            playMusic(currentTrack);
        } else {
            playRandomMusic(); 
        }
    }
});

function createVisualizer() {
    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        canvas = document.createElement('canvas');
        canvas.style.position = 'fixed';
        canvas.style.bottom = '0';
        canvas.style.left = '0';
        canvas.style.width = '100%';
        canvas.style.height = '150px';
        canvas.style.pointerEvents = 'none';
        document.body.appendChild(canvas);

        canvasCtx = canvas.getContext('2d');

        analyser = audioContext.createAnalyser();
        analyser.fftSize = 256;
        bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);
    }
}

function drawVisualizer() {
    if (!canvas || !canvasCtx || !analyser) {
        return;
    }

    requestAnimationFrame(drawVisualizer);

    analyser.getByteFrequencyData(dataArray);

    canvasCtx.clearRect(0, 0, canvas.width, canvas.height);

    const barWidth = (canvas.width / bufferLength) * 2.5;
    let barHeight;
    let x = 0;

    for (let i = 0; i < bufferLength; i++) {
        barHeight = dataArray[i];

        canvasCtx.fillStyle = 'rgba(255, 255, 255, 0.7)';
        canvasCtx.fillRect(x, canvas.height - barHeight / 2, barWidth, barHeight / 2);

        x += barWidth + 1;
    }
}

<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>
<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>
<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>
const getCurrencySymbol = (currencyCode) => ({ "USD": "$", "EUR": "€", "GBP": "£", "JPY": "¥", "RUB": "₽", "UAH": "₴", "BRL": "R$", "CAD": "C$", "AUD": "A$", "CHF": "Fr", "CNY": "¥", "KRW": "₩", "INR": "₹", "MXN": "Mex$", "PLN": "zł", "ZAR": "R", "TRY": "₺", "AED": "د.إ", "THB": "฿", "TWD": "NT$", "SAR": "ر.س", "QAR": "ر.ق", "KWD": "د.ك", "KZT": "₸", "MYR": "RM", "IDR": "Rp", "ILS": "₪", "COP": "$", "CRC": "₡", "PEN": "S/", "PHP": "₱", "VND": "₫", "CLP": "$", "GEL": "₾", "HRK": "kn", "HUF": "Ft", "LKR": "Rs", "MDL": "L", "NOK": "kr", "RON": "lei", "SEK": "kr", "UGX": "USh", "MNT": "₮", "TZS": "TSh", "NAD": "$", "ZWL": "$", "BAM": "KM", "GHS": "₵", "BND": "$", "SBD": "$", "MOP": "MOP$", "PGK": "K" })[currencyCode] || currencyCode;
let priceData; 
let salenotifications = 0;

fetch('price_standalone.json')
    .then(response => response.ok ? response.json() : Promise.reject('Error: ' + response.statusText))
    .then(data => priceData = data)
    .catch(console.error); 

async function updatePrice(countryCode) {
    try {
        console.log(`Updating price for country: ${countryCode}`);
        
        const priceData = await getGamePrice(countryCode);
        console.log(`Fetched price data: `, priceData);

        const amountInput = document.getElementById('amount');
        const priceElement = document.getElementById('result');
        const currencySymbol = document.getElementById('currencySymbol');
        const countryFlag = document.getElementById('countryFlag');

        if (priceData[steamAppId] && priceData[steamAppId].data && priceData[steamAppId].data.price_overview) {
            const price = priceData[steamAppId].data.price_overview.final / 100;
            console.log(`Price: ${price}`);
            
            let currencyCode = priceData[steamAppId].data.price_overview.currency;
            console.log(`Currency code before check: ${currencyCode}`);
            
            if (countryFlag.getAttribute('data-country-code') === 'EU') {
                currencyCode = 'EUR';
                console.log(`Currency code adjusted for EU region: ${currencyCode}`);
            }

            currencySymbol.textContent = getCurrencySymbol(currencyCode);
            console.log(`Set currency symbol: ${currencySymbol.textContent}`);

            let previousDisplayText = '';

            const updatePriceDisplay = () => {
                setTimeout(() => {
                    const rawAmount = amountInput.value;
                    const numericAmount = rawAmount.replace(/\D/g, '');

                    const amount = parseFloat(numericAmount);
                    let displayText = '';

                    if (!isNaN(amount)) {
                        const convertedAmount = Math.floor(amount / price);

                        if (convertedAmount > 0) {
                            if (convertedAmount.toString().includes('e')) {
                                displayText = `You can buy<br><span id="animated-text" class="animated-text">a lot but not enough</span> <br>copies of NieR:Automata.`;
                            } else {
                                displayText = `You can buy<br><span id="copyCount" class="typewriter">${convertedAmount}</span> <br>copies of NieR:Automata.`;
                            }

                            if (displayText !== previousDisplayText) {
                                previousDisplayText = displayText; 
                                priceElement.innerHTML = displayText;
                                showPurchaseButtons();
                            }
                        } else {
                            priceElement.innerHTML = '';
                            hidePurchaseButtons();
                        }
                    } else {
                        priceElement.innerHTML = '';
                        hidePurchaseButtons();
                    }
                }, 100);
            };

            amountInput.addEventListener('input', updatePriceDisplay);
            console.log('Added event listener for amount input.');

            amountInput.addEventListener('input', () => {
                const inputText = amountInput.value.trim().toLowerCase();
                for (const phraseKey in phrases) {
                    if (containsAllWords(inputText, phraseKey)) {
                        playMusic(phraseKey);
                        console.log(`Playing music for phrase: ${phraseKey}`);
                        break;
                    }
                }
            });

            updatePriceDisplay();
            if (globalDiscountPercent && globalDiscountPercent !== 0 && salenotifications >= 1) {
                showNotification(`NieR:Automata is on sale in ${countryCode}. Discount percent is ${globalDiscountPercent}%`);
                console.log(`Discount detected: ${globalDiscountPercent}%`);
            }

            salenotifications++;

        } else {
            throw new Error('Price information not available');
        }
    } catch (error) {
        console.error('Error:', error);
        showNotification('NieR:Automata is not available in your country. Switched to the USA.');
        document.getElementById('countryFlag').src = 'flags/us.png';
        await updatePrice('US');
    }
}



document.querySelectorAll('.country-list li').forEach(item => {
    item.addEventListener('click', async () => {
        const selectedCountryCode = item.dataset.countryCode;
        const flagSrc = item.querySelector('img').src;
        const countryFlag = document.getElementById('countryFlag');
        countryFlag.src = flagSrc;
        countryFlag.dataset.countryCode = selectedCountryCode;

        document.getElementById('countryModal').classList.remove('show');
        document.cookie = `selectedCountryCode=${selectedCountryCode}; path=/; expires=Sun, 31 Dec 11944 23:59:59 GMT`;
        await updatePrice(selectedCountryCode);
    });
});



function containsAllWords(inputText, phraseKey) {
    const words = phraseKey.split(' ');
    return words.every(word => inputText.includes(word));
}

async function loadImage(url) {
    return new Promise((resolve, reject) => {
        const img = new Image();
        img.src = url;
        img.onload = () => resolve();
        img.onerror = (error) => reject(error);
    });
}

async function changeBackground(imageUrl) {
    const body = document.body;
    const currentBackground = body.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi, '$2');

    if (currentBackground === imageUrl) return;

    body.classList.add('fade-in');

    try {
        await loadImage(imageUrl);
        const img = new Image();
        img.src = imageUrl;
        img.onload = () => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = img.width;
            canvas.height = 10;  
            ctx.drawImage(img, 0, img.height - 10, img.width, 10, 0, 0, img.width, 10);
            
            const tempImg = new Image();
            tempImg.src = canvas.toDataURL();
            tempImg.onload = () => {
                const colorThief = new ColorThief();
                const dominantColor = colorThief.getColor(tempImg);

                const rgbColor = `rgb(${dominantColor[0]}, ${dominantColor[1]}, ${dominantColor[2]})`;
                body.style.backgroundColor = rgbColor;
                setTimeout(() => {
                    body.style.backgroundImage = `url(${imageUrl})`;
                }, 200);

                setTimeout(() => body.classList.remove('fade-in'), 1000);
            };
        };
    } catch (error) {
        console.error('Error:', error);
    }
}

function updateBackgroundBasedOnOrientation() {
    const orientation = window.innerWidth / window.innerHeight > 1 ? 'landscape' : 'portrait';
    const body = document.body;
    const currentBackground = body.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi, '$2');

    const trackName = Object.keys(phrases).find(key => {
        const trackBackground = phrases[key];
        return (
            trackBackground.background === currentBackground || 
            trackBackground.backgroundAndroid === currentBackground
        );
    });

    if (trackName) {
        const targetBackground =
            orientation === 'portrait' && phrases[trackName].backgroundAndroid !== 'backgrounds/!!!!!!!!!.jpg'
                ? phrases[trackName].backgroundAndroid
                : phrases[trackName].background;

        if (currentBackground !== targetBackground) {
            changeBackground(targetBackground);
        }
    }
}

window.addEventListener('resize', updateBackgroundBasedOnOrientation);
document.addEventListener('DOMContentLoaded', updateBackgroundBasedOnOrientation);


document.getElementById('result').addEventListener('click', function() {
    window.open('https://store.steampowered.com/app/524220/NieRAutomata/', '_blank');
});

<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>
<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>
<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>

document.addEventListener('click', function(event) {
    const target = event.target;
    if (target.classList.contains('notification-key')) {
        const key = target.getAttribute('data-key');
        handleKeyAction(key);
    }
});

function showNotification(message) {

    let formattedMessage = message.replace(/\n/g, '<br>').replace(/\[(H|P|N|Q)\]/g, match => 
        `<span class="notification-key" data-key="${match}">${match}</span>`
    );

    const discountPercentMatch = message.match(/Discount percent is (\d+)%/);
    if (discountPercentMatch) {
        const discountPercent = discountPercentMatch[1];
        formattedMessage = formattedMessage.replace(
            `Discount percent is ${discountPercent}%`, 
            `<span class="discount-highlight">Discount percent is <b>${discountPercent}%</b></span>`
        );
    }

    const notification = document.getElementById('notification');
    notification.querySelector('p').innerHTML = formattedMessage;
    notification.style.display = 'block';
    notification.style.animation = 'fadeIn 0.5s ease-in-out';

    setTimeout(() => {
        notification.style.animation = 'fadeOut 0.5s ease-in-out';
        setTimeout(() => {
            notification.style.display = 'none';
        }, 500);
    }, 2300);
}


function handleKeyAction(key) {
    const actions = {
        '[H]': toggleVisibility,
        '[P]': () => {
            const currentAudio = document.getElementById('current-audio');
            if (currentAudio) {
                if (currentAudio.paused) {
                    fadeInAudio(currentAudio);
                    isPlaying = true;
                } else {
                    fadeOutAudio(currentAudio).then(() => {
                        currentAudio.pause();
                        isPlaying = false;
                    });
                }
                updatePlayIcon();
            }
        },
        '[N]': () => isPlaying && playRandomMusic(),
        '[Q]': toggleAudioFormat,
    };

    (actions[key] || (() => console.log('Unknown key')))();
}

function toggleAudioFormat() {
	if (audioFormatPreference === 0 || audioFormatPreference === 2) {
		audioFormatPreference = 1;
		showNotification('Format changed to mp3 - 320 kbps');
	} else {
		audioFormatPreference = 2;
		showNotification('Format changed to flac - up to 1000 kbps');
	}
	updateButtonText(); 
	saveAudioFormatPreferenceToCookie(); 
}


function updateButtonText() {
    const button = document.getElementById('audioToggleBtn');
    let newText;

    if (audioFormatPreference === 0) {
        newText = 'AUDIO QUALITY - AUTO';
    } else if (audioFormatPreference === 1) {
        newText = 'AUDIO QUALITY - MP3 (320 KBPS)';
    } else {
        newText = 'AUDIO QUALITY - FLAC (UP TO 1000 KBPS)';
    }

    button.classList.add('fade-out');
    setTimeout(() => {
        button.textContent = newText;
        button.classList.remove('fade-out');
    }, 500);
}



document.addEventListener('keydown', async (event) => {
    const isTyping = document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA';
    if (isTyping) return; 

    if (event.code === 'KeyH') {
        event.preventDefault();
        toggleVisibility();
    }

    if (event.code === 'KeyP') {
        event.preventDefault();
        const currentAudio = document.getElementById('current-audio');
        if (currentAudio) {
            if (currentAudio.paused) {
                currentAudio.play()
                isPlaying = true;
                updatePlayIcon();
            } else {
                currentAudio.pause();
                isPlaying = false;
                updatePlayIcon();
            }
        }
    }

    if (event.code === 'KeyN' && isPlaying) {
        event.preventDefault();
        playRandomMusic();
    }

    if (event.code === 'KeyQ') {
        event.preventDefault();
        toggleAudioFormat();
    }
});


function toggleVisibility() {
    const elementsToToggle = [
        document.querySelector('.container'),
        document.getElementById('Settings')
    ];

    elementsToToggle.forEach(element => {
        if (window.getComputedStyle(element).display === 'none') {
            element.style.display = '';
            setTimeout(() => {
                element.style.transition = 'opacity 0.5s';
                element.style.opacity = 1;
            }, 10);
        } else {
            element.style.transition = 'opacity 0.5s';
            element.style.opacity = 0;
            setTimeout(() => {
                element.style.display = 'none';
            }, 500);
        }
    });
}

<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>
<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>
<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>


let buttonsShown = false; 

function updatePriceDisplay() {
    const amount = parseFloat(amountInput.value);
    if (!isNaN(amount)) {
        const convertedAmount = Math.floor(amount / price);
        if (convertedAmount > 0) {
            priceElement.innerHTML = `You can buy <span class="typing-animation">${convertedAmount}</span> copies of NieR:Automata.`;
            showPurchaseButtons();
        } else {
            priceElement.innerHTML = '';
        }
    } else {
        priceElement.innerHTML = '';
    }
}

function hidePurchaseButtons() {
    if (!buttonsShown) return;

    const buttonsContainer = document.getElementById('purchaseButtons');
    const buttons = buttonsContainer.querySelectorAll('.purchase-button');

    buttons.forEach(button => {
        button.classList.remove('show');
        button.classList.add('hide');
    });

    setTimeout(() => {
        buttons.forEach(button => button.classList.remove('hide')); 
        buttonsContainer.innerHTML = '';
        buttonsShown = false; 
    }, 300);
}


function showPurchaseButtons() {
    if (buttonsShown) return; 

    const buttonsContainer = document.getElementById('purchaseButtons');
    buttonsContainer.innerHTML = `
		<div class="purchase-button" id="xboxButton">
			<img src="icons/xbox.png" alt="Xbox">
		</div>
		<div class="purchase-button" id="steamButton">
			<img src="icons/steam.png" alt="Steam">
		</div>
		<div class="purchase-button" id="walmartButton">
			<img src="icons/walmart.png" alt="Walmart">
		</div>

    `;

    const buttonImages = document.querySelectorAll('.purchase-button img');
    buttonImages.forEach(async (img) => {
        try {
            const dominantColor = await getDominantColor(img.src);
            img.parentElement.style.filter = `drop-shadow(0 0 10px ${dominantColor}) brightness(1.2)`;
        } catch (error) {
            console.error('Error getting dominant color:', error);
        }
    });

    document.getElementById('xboxButton').addEventListener('click', () => {
        window.open('https://www.xbox.com/games/store/nier-automata-become-as-gods-edition/bppzvt8bz15n', '_blank');
    });

    document.getElementById('steamButton').addEventListener('click', () => {
        window.open('https://store.steampowered.com/app/524220/NieRAutomata/', '_blank');
    });

    document.getElementById('walmartButton').addEventListener('click', () => {
        window.open('https://weblet.square-enix.com/elink.php?doc=NIERAUTO&code=WEBSITE&lang=us&id=STORE19&store=Walmart&platform=PS4&edition=Game+of+the+Yorha+Edition&_gl=1*jxvhee*_gcl_au*MTQ3MzMzODA2Ny4xNzI0OTEwMTg2&_ga=2.174762210.1729472430.1724910187-1926933269.1724910187', '_blank');
    });

    const buttons = buttonsContainer.querySelectorAll('.purchase-button');
    buttons.forEach(button => {
        button.classList.remove('hide');
        button.classList.add('show');
    });

    buttonsShown = true; 
}

<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>
<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>
<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>


async function setRandomBackground() {
    const aspectRatio = window.innerWidth / window.innerHeight;
    console.log(`aspectRatio: ${aspectRatio}`);

    const backgrounds = Math.abs(aspectRatio - 9 / 16) < Math.abs(aspectRatio - 16 / 9) 
        ? ['backgrounds/android1.jpg', 'backgrounds/android4.jpg'] 
        : ['backgrounds/background.jpg', 'backgrounds/background02.jpg'];

    const selectedBackground = backgrounds[Math.floor(Math.random() * backgrounds.length)];
    console.log(`Selected background: ${selectedBackground}`);
    await changeBackground(selectedBackground);
}


window.addEventListener('load', async function() {
    const overlay = document.getElementById('loadingOverlay');
    const cookies = document.cookie.split('; ');
    const savedCountryCode = cookies.find(cookie => cookie.startsWith('selectedCountryCode='));
    const countryCode = savedCountryCode ? savedCountryCode.split('=')[1] : null;

    let finalCountryCode;
    if (countryCode) {
        finalCountryCode = countryCode;
        console.log(`Loaded country code from cookie: ${finalCountryCode}`);
    } else {
        const locationData = await getIpAndLocation();
        finalCountryCode = locationData.country_code;
        console.log(`Determined country code by IP: ${finalCountryCode}`);
    }

    document.getElementById('countryFlag').src = `flags/${finalCountryCode.toLowerCase()}.png`;
    document.getElementById('countryFlag').setAttribute('data-country-code', finalCountryCode);
    console.log(`Country flag set for code: ${finalCountryCode}`);

    await Promise.all([
        updatePrice(finalCountryCode),
        setRandomBackground()
    ]);

    console.log("Background set and price updated");

    await new Promise(resolve => setTimeout(resolve, 250));
    overlay.classList.add('hide');
    await new Promise(resolve => setTimeout(resolve, 900));
    overlay.style.display = 'none';
    console.log("Overlay hidden");
    if (globalDiscountPercent && globalDiscountPercent !== 0) {
        showNotification(`NieR:Automata is on sale in ${finalCountryCode}. Discount percent is ${globalDiscountPercent}%`);
    } else {
        console.log("No discount available in your region.");
    }
});

<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>
<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>
<!-----------------------------------------------------------------------------------------------------------------------------------------------------!>

    </script>
</body>
</html>
